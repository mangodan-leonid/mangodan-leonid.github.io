import{c as rt,u as it,i as ut,a as ct,b as ht,d as dt,e as ft,f as vt,g as gt,V as mt,h as Vt}from"./WorldMapLayout-C21sq9qm.js";import{ax as pt,r as q,d as x,ay as wt,o as lt,az as nt,a3 as yt,y as xt,A as G,a4 as K,a5 as j,W as C,a7 as Ct,X as U,am as W,a6 as J,aB as D,ad as Z,aa as Y}from"./index-CVVW5v8G.js";import{k as tt,V as Dt,T as It}from"./VBtn-Chtr_KLN.js";function N(e){return Array.isArray(e)?e.filter(a=>a!=null&&typeof a=="number"&&!isNaN(a)&&isFinite(a)&&a!==0):(console.warn("filterValidNumbers: 입력이 배열이 아닙니다",e),[])}function z(e,a=2){const u=N(e);return u.length<a?(console.warn(`getLatestValidValues: 유효한 값이 ${a}개보다 적습니다`,{requested:a,available:u.length,validValues:u.slice(-5)}),u):u.slice(-a)}function et(e,a){return e===null||a===null||e===void 0||a===void 0||isNaN(e)||isNaN(a)?null:e-a}function at(e,a){return e===null||a===null||e===void 0||a===void 0||isNaN(e)||isNaN(a)||a===0?null:(e-a)/a*100}function qt(e){try{if(!e?.chart?.result?.[0])return console.warn("validateYahooFinanceData: 기본 구조가 올바르지 않습니다"),null;const a=e.chart.result[0];if(!a.indicators?.quote?.[0]?.close)return console.warn("validateYahooFinanceData: close 데이터가 없습니다"),null;const u=a.indicators.quote[0].close;if(!Array.isArray(u))return console.warn("validateYahooFinanceData: close 데이터가 배열이 아닙니다"),null;const c=N(u);return c.length===0?(console.warn("validateYahooFinanceData: 유효한 값이 없습니다"),null):(console.log("validateYahooFinanceData: 데이터 검증 성공",{totalLength:u.length,validCount:c.length,latestValid:c.slice(-3)}),{...a,validCloses:c,originalCloses:u})}catch(a){return console.error("validateYahooFinanceData: 데이터 검증 중 오류",a),null}}function $(e){if(!Array.isArray(e))return{score:0,issues:["배열이 아님"]};const a=e.length,c=N(e).length,m=e.filter(V=>V===null).length,L=e.filter(V=>V===void 0).length,w=e.filter(V=>typeof V=="number"&&isNaN(V)).length,S=a>0?c/a*100:0,y=[];return m>0&&y.push(`${m}개 null 값`),L>0&&y.push(`${L}개 undefined 값`),w>0&&y.push(`${w}개 NaN 값`),{score:Math.round(S),validCount:c,totalCount:a,issues:y,isValid:S>=50}}const st=pt("vix",()=>{const e=q(null),a=q(null),u=q(!1),c=q(null),m=q(null),L=x(()=>{if(e.value?.indicators?.quote?.[0]?.close?.length>0){const t=e.value.indicators.quote[0].close,l=N(t);if(l.length>0){const o=l[l.length-1];return console.log("VIX 실시간 데이터에서 현재 값:",{result:o,totalLength:t.length,validCount:l.length,latestValid:l.slice(-3),dataQuality:$(t)}),o}}if(a.value?.indicators?.quote?.[0]?.close?.length>0){const t=a.value.indicators.quote[0].close,l=N(t);if(l.length>0){const o=l[l.length-1];return console.log("VIX 히스토리 데이터에서 현재 값:",{result:o,totalLength:t.length,validCount:l.length,latestValid:l.slice(-3),dataQuality:$(t)}),o}}return console.log("VIX 현재 값 계산 불가 - 데이터 없음"),null}),w=x(()=>{if(e.value?.indicators?.quote?.[0]?.close?.length>=2){const t=e.value.indicators.quote[0].close,l=z(t,2);if(l.length>=2){const[o,h]=l,d=et(h,o);return console.log("VIX 실시간 데이터 변화량 계산:",{current:h,previous:o,change:d,totalLength:t.length,validCount:N(t).length,dataQuality:$(t)}),d}}if(a.value?.indicators?.quote?.[0]?.close?.length>=2){const t=a.value.indicators.quote[0].close,l=z(t,2);if(l.length>=2){const[o,h]=l,d=et(h,o);return console.log("VIX 히스토리 데이터 변화량 계산:",{current:h,previous:o,change:d,totalLength:t.length,validCount:N(t).length,dataQuality:$(t)}),d}}return null}),S=x(()=>{if(e.value?.indicators?.quote?.[0]?.close?.length>=2){const t=e.value.indicators.quote[0].close,l=z(t,2);if(l.length>=2){const[o,h]=l,d=at(h,o);return console.log("VIX 실시간 데이터 변화율 계산:",{current:h,previous:o,changePercent:d,totalLength:t.length,validCount:N(t).length,dataQuality:$(t)}),d}}if(a.value?.indicators?.quote?.[0]?.close?.length>=2){const t=a.value.indicators.quote[0].close,l=z(t,2);if(l.length>=2){const[o,h]=l,d=at(h,o);return console.log("VIX 히스토리 데이터 변화율 계산:",{current:h,previous:o,changePercent:d,totalLength:t.length,validCount:N(t).length,dataQuality:$(t)}),d}}return console.log("VIX 변화율 계산 불가 - 데이터 부족"),null}),y=x(()=>{const t=L.value;return t?t<20?"low":t<30?"normal":"high":"unknown"}),V=x(()=>{switch(y.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),g=x(()=>{switch(y.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),T=x(()=>{if(a.value&&a.value.timestamp){const t=a.value.timestamp||[],l=a.value.indicators?.quote?.[0]?.close||[],o=a.value.indicators?.quote?.[0]?.high||[],h=a.value.indicators?.quote?.[0]?.low||[],d=a.value.indicators?.quote?.[0]?.open||[],i=a.value.indicators?.quote?.[0]?.volume||[],s=t.map((r,n)=>({timestamp:r*1e3,date:new Date(r*1e3),close:l[n]!==null&&l[n]!==void 0?l[n]:null,high:o[n]!==null&&o[n]!==void 0?o[n]:null,low:h[n]!==null&&h[n]!==void 0?h[n]:null,open:d[n]!==null&&d[n]!==void 0?d[n]:null,volume:i[n]!==null&&i[n]!==void 0?i[n]:null})).filter(r=>r.close!==null&&r.close!==void 0);return console.log("VIX 차트 데이터 (히스토리):",{totalItems:s.length,firstItem:s[0],lastItem:s[s.length-1]}),s}if(e.value&&e.value.timestamp){const t=e.value.timestamp||[],l=e.value.indicators?.quote?.[0]?.close||[],o=e.value.indicators?.quote?.[0]?.high||[],h=e.value.indicators?.quote?.[0]?.low||[],d=e.value.indicators?.quote?.[0]?.open||[],i=e.value.indicators?.quote?.[0]?.volume||[],s=t.map((r,n)=>({timestamp:r*1e3,date:new Date(r*1e3),close:l[n]!==null&&l[n]!==void 0?l[n]:null,high:o[n]!==null&&o[n]!==void 0?o[n]:null,low:h[n]!==null&&h[n]!==void 0?h[n]:null,open:d[n]!==null&&d[n]!==void 0?d[n]:null,volume:i[n]!==null&&i[n]!==void 0?i[n]:null})).filter(r=>r.close!==null&&r.close!==void 0);return console.log("VIX 차트 데이터 (실시간):",{totalItems:s.length,firstItem:s[0],lastItem:s[s.length-1]}),s}return console.log("VIX 차트 데이터 없음"),[]}),E=x(()=>T.value.map(t=>new Date(t.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),X=x(()=>T.value.map(t=>t.close)),F=x(()=>{const t=X.value.filter(l=>l!==null);return t.length>0?Math.min(...t):0}),R=x(()=>{const t=X.value.filter(l=>l!==null);return t.length>0?Math.max(...t):0}),k=x(()=>{const t=X.value.filter(l=>l!==null);return t.length>0?t.reduce((l,o)=>l+o,0)/t.length:0}),A=t=>{e.value=t,m.value=new Date,c.value=null},M=t=>{a.value=t,m.value=new Date,c.value=null},_=t=>{u.value=t},I=t=>{c.value=t,u.value=!1},P=()=>{c.value=null},b=()=>{if(!m.value)return!1;const t=new Date(m.value);return new Date().getTime()-t.getTime()<3600*1e3};return{vixData:e,vixHistoryData:a,loading:u,error:c,lastUpdated:m,currentVix:L,vixChange:w,vixChangePercent:S,vixStatus:y,vixStatusText:V,vixStatusColor:g,chartData:T,chartLabels:E,chartValues:X,minValue:F,maxValue:R,averageValue:k,setVixData:A,setVixHistoryData:M,setLoading:_,setError:I,clearError:P,reset:()=>{e.value=null,a.value=null,u.value=!1,c.value=null,m.value=null},isCacheValid:b,hasValidCache:()=>(e.value||a.value)&&m.value&&b()}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function Lt(){const e=st(),a=rt(),{vixData:u,vixHistoryData:c,loading:m,error:L,lastUpdated:w,currentVix:S,vixChange:y,vixChangePercent:V,vixStatus:g,vixStatusText:T,vixStatusColor:E,chartData:X,chartLabels:F,chartValues:R,minValue:k,maxValue:A,averageValue:M}=wt(e),_=q(null),I=q(!1),P=q(3600*1e3),b=async(i=!1)=>{try{if(!i&&e.hasValidCache()){const r=Date.now()-new Date(w.value).getTime(),n=Math.floor(r/(60*1e3)),Q=Math.floor((3600*1e3-r)/(60*1e3));return u.value}else if(!i&&w.value){const r=Date.now()-new Date(w.value).getTime(),n=Math.floor(r/(3600*1e3))}e.setLoading(!0),e.clearError(),await new Promise(r=>setTimeout(r,1e3));const s=await a.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(s.data&&s.data.chart&&s.data.chart.result&&s.data.chart.result[0]){const r=s.data.chart.result[0];if(qt(s.data))console.log("VIX API 응답 구조:",{hasIndicators:!!r.indicators,hasQuote:!!r.indicators?.quote,quoteLength:r.indicators?.quote?.length,hasClose:!!r.indicators?.quote?.[0]?.close,closeLength:r.indicators?.quote?.[0]?.close?.length,closeData:r.indicators?.quote?.[0]?.close?.slice(-5),dataQuality:$(r.indicators?.quote?.[0]?.close||[])}),e.setVixData(r);else throw console.error("VIX 데이터 검증 실패:",{hasData:!!s.data,hasChart:!!s.data?.chart,hasResult:!!s.data?.chart?.result,resultLength:s.data?.chart?.result?.length,firstResult:s.data?.chart?.result?.[0]}),new Error("VIX 데이터 검증에 실패했습니다.")}else throw console.error("VIX 데이터 형식 오류:",{hasData:!!s.data,hasChart:!!s.data?.chart,hasResult:!!s.data?.chart?.result,resultLength:s.data?.chart?.result?.length,firstResult:s.data?.chart?.result?.[0]}),new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(s){console.error("VIX 데이터 가져오기 실패:",s),e.setError(s.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{e.setLoading(!1)}},p=async(i="1mo",s=!1)=>{try{if(!s&&c.value&&c.value.timestamp)return console.log("VIX 히스토리 데이터 캐시 사용"),c.value;e.setLoading(!0),e.clearError(),await new Promise(v=>setTimeout(v,2e3));const r={range:i,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"};let n;const Q=3;let H=null;for(let v=1;v<=Q;v++)try{{const B=`https://query1.finance.yahoo.com/v8/finance/chart/^VIX?${new URLSearchParams(r).toString()}`,O=`https://api.allorigins.win/raw?url=${encodeURIComponent(B)}`;n=await fetch(O),n={data:await n.json()}}break}catch(B){if(H=B,v<Q){const O=2e3*Math.pow(2,v-1);await new Promise(ot=>setTimeout(ot,O))}}if(H&&!n)throw H;if(n.data&&n.data.chart&&n.data.chart.result&&n.data.chart.result[0]){const v=n.data.chart.result[0];return console.log("VIX 히스토리 데이터 저장:",{period:i,timestampLength:v.timestamp?.length,closeLength:v.indicators?.quote?.[0]?.close?.length,firstTimestamp:v.timestamp?.[0],lastTimestamp:v.timestamp?.[v.timestamp?.length-1],firstClose:v.indicators?.quote?.[0]?.close?.[0],lastClose:v.indicators?.quote?.[0]?.close?.[v.indicators?.quote?.[0]?.close?.length-1]}),e.setVixHistoryData(v),v}else throw console.error("VIX 데이터 구조 문제:",n.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(r){return console.error("VIX 히스토리 데이터 가져오기 실패:",r),e.setError(r.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{e.setLoading(!1)}},f=()=>{_.value||(I.value=!0,_.value=setInterval(()=>{b()},P.value))},t=()=>{_.value&&(clearInterval(_.value),_.value=null,I.value=!1)},l=i=>{P.value=i,I.value&&(t(),f())};return lt(()=>{b(),f()}),nt(()=>{t()}),{vixData:u,vixHistoryData:c,loading:m,error:L,lastUpdated:w,currentVix:S,vixChange:y,vixChangePercent:V,vixStatus:g,vixStatusText:T,vixStatusColor:E,chartData:X,chartLabels:F,chartValues:R,minValue:k,maxValue:A,averageValue:M,autoRefreshEnabled:I,refreshInterval:P,fetchVixData:b,fetchVixHistory:p,startAutoRefresh:f,stopAutoRefresh:t,setRefreshInterval:l,formatVixValue:i=>i==null?"N/A":i.toFixed(2),formatVixChange:i=>i==null?"N/A":`${i>=0?"+":""}${i.toFixed(2)}`,formatVixChangePercent:i=>i==null?"N/A":`${i>=0?"+":""}${i.toFixed(2)}%`,clearError:e.clearError,reset:e.reset}}const Xt={class:"vix-chart-container"},_t={class:"chart-header"},bt={class:"chart-title"},Nt={class:"chart-controls"},St={class:"current-info"},Tt={class:"info-card"},Rt={class:"status-card"},Pt={class:"chart-wrapper"},$t={key:0,class:"loading-overlay"},Et={__name:"VixChart",setup(e){it([ut,ct,ht,dt,ft,vt]),q(!1);const a=q(null);let u=null;const c=gt(),m=st(),{currentVix:L,vixChange:w,vixChangePercent:S,vixStatusText:y,vixStatusColor:V,chartData:g,chartLabels:T,chartValues:E,loading:X,fetchVixData:F,fetchVixHistory:R,formatVixValue:k,formatVixChange:A,formatVixChangePercent:M}=Lt(),_=async()=>{if(await G(),!a.value){console.warn("VIX 차트 초기화 실패: chartRef가 null입니다");return}try{u=Vt(a.value,null,{renderer:"canvas",useDirtyRect:!0}),c.registerChart("vix",u),window.addEventListener("resize",b);const p={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"8%",right:"8%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",axisLabel:{formatter:function(t){return t.toFixed(2)}}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};u.setOption(p,!0),m.hasValidCache()?await R("1mo"):(await F(),await R("1mo"));const f=(t=1,l=5)=>{g.value&&g.value.length>0?I():t<l&&setTimeout(()=>{f(t+1,l)},500*t)};setTimeout(()=>{f()},100)}catch(p){console.error("VIX 차트 초기화 실패:",p)}},I=()=>{if(!u||!g.value||!g.value.length)return;const p=E.value.filter(l=>l!=null),f=T.value.slice(0,p.length),t={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis",formatter:function(l){const o=l[0];return`${new Date(o.axisValue).toLocaleDateString("ko-KR")}<br/>VIX: ${o.value.toFixed(2)}`}},grid:{left:"8%",right:"8%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:f},yAxis:{type:"value",min:function(l){return Math.max(0,l.min*.9)},max:function(l){return l.max*1.1},axisLabel:{formatter:function(l){return l.toFixed(2)}}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:p}]};u.setOption(t,!0)},P=async()=>{try{await F(!0),await R("1mo",!0),setTimeout(()=>{g.value&&g.value.length>0?I():setTimeout(()=>{g.value&&g.value.length>0&&I()},500)},200)}catch(p){console.error("새로고침 중 오류:",p)}},b=()=>{u&&u.resize()};return xt([g,T,E],(p,f)=>{G(()=>{g.value&&g.value.length>0&&I()})},{deep:!0,immediate:!1}),lt(()=>{G(()=>{_()})}),nt(()=>{u&&c.unregisterChart("vix"),window.removeEventListener("resize",b)}),(p,f)=>(j(),K("div",Xt,[C("div",_t,[C("div",bt,[U(tt,{icon:"mdi-chart-line",class:"me-2"}),f[0]||(f[0]=W(" VIX 지수 ",-1))]),C("div",Nt,[U(Dt,{variant:"text",size:"small",onClick:P,loading:D(X)},{default:J(()=>[U(tt,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),C("div",St,[C("div",Tt,[f[1]||(f[1]=C("div",{class:"info-label"},"현재 VIX",-1)),C("div",{class:Z(["info-value",D(V)])},Y(D(k)(D(L))),3),C("div",{class:Z(["info-change",D(w)>=0?"positive":"negative"])},Y(D(A)(D(w)))+" ("+Y(D(M)(D(S)))+") ",3)]),C("div",Rt,[f[2]||(f[2]=C("div",{class:"status-label"},"시장 상태",-1)),U(mt,{color:D(V),size:"small",variant:"flat"},{default:J(()=>[W(Y(D(y)),1)]),_:1},8,["color"])])]),C("div",Pt,[C("div",{ref_key:"chartRef",ref:a,class:"chart",style:{height:"400px"}},null,512)]),D(X)?(j(),K("div",$t,[U(It,{indeterminate:"",color:"primary",size:"48"})])):Ct("",!0)]))}},Mt=yt(Et,[["__scopeId","data-v-60711e49"]]);export{Mt as default};
