import{c as J,u as Q,a as Z,i as ee,b as te,d as ae,e as oe,f as se,g as le,h as re}from"./useChartManager-ydbel_Xl.js";import{b2 as ne,r as p,d as h,b3 as ie,o as K,b4 as W,a3 as ce,y as ue,A as U,a4 as $,a5 as z,W as g,ak as B,X as k,al as F,a6 as O,av as c,a9 as Y,ad as H}from"./index-tszKi_TY.js";import{k as G,V as ve,T as he}from"./VBtn-Bcwu_4uR.js";import{V as de}from"./WorldMapLayout-C4phI3jI.js";const j=ne("vix",()=>{const a=p(null),o=p(null),r=p(!1),i=p(null),f=p(null),C=h(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),D=h(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;if(!e||e.length<2)return null;const s=e[e.length-1],v=e[e.length-2];return s-v}),S=h(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;if(!e||e.length<2)return null;const s=e[e.length-1],v=e[e.length-2];return(s-v)/v*100}),_=h(()=>{const e=C.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),L=h(()=>{switch(_.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),l=h(()=>{switch(_.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),m=h(()=>{if(console.log("chartData computed 실행, vixHistoryData:",o.value),!o.value||!o.value.timestamp)return console.log("차트 데이터 없음"),[];const e=o.value.timestamp||[],s=o.value.indicators?.quote?.[0]?.close||[],v=o.value.indicators?.quote?.[0]?.high||[],P=o.value.indicators?.quote?.[0]?.low||[],N=o.value.indicators?.quote?.[0]?.open||[],M=o.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:s.length,firstTimestamp:e[0],firstClose:s[0]});const R=e.map((t,n)=>({timestamp:t*1e3,date:new Date(t*1e3),close:s[n]||null,high:v[n]||null,low:P[n]||null,open:N[n]||null,volume:M[n]||null})).filter(t=>t.close!==null);return console.log("차트 데이터 결과:",R.length,"개 항목"),R}),w=h(()=>m.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),y=h(()=>m.value.map(e=>e.close)),b=h(()=>{const e=y.value.filter(s=>s!==null);return e.length>0?Math.min(...e):0}),E=h(()=>{const e=y.value.filter(s=>s!==null);return e.length>0?Math.max(...e):0}),T=h(()=>{const e=y.value.filter(s=>s!==null);return e.length>0?e.reduce((s,v)=>s+v,0)/e.length:0});return{vixData:a,vixHistoryData:o,loading:r,error:i,lastUpdated:f,currentVix:C,vixChange:D,vixChangePercent:S,vixStatus:_,vixStatusText:L,vixStatusColor:l,chartData:m,chartLabels:w,chartValues:y,minValue:b,maxValue:E,averageValue:T,setVixData:e=>{a.value=e,f.value=new Date,i.value=null},setVixHistoryData:e=>{o.value=e,f.value=new Date,i.value=null},setLoading:e=>{r.value=e},setError:e=>{i.value=e,r.value=!1},clearError:()=>{i.value=null},reset:()=>{a.value=null,o.value=null,r.value=!1,i.value=null,f.value=null}}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function ge(){const a=j(),o=J(),{vixData:r,vixHistoryData:i,loading:f,error:C,lastUpdated:D,currentVix:S,vixChange:_,vixChangePercent:L,vixStatus:l,vixStatusText:m,vixStatusColor:w,chartData:y,chartLabels:b,chartValues:E,minValue:T,maxValue:A,averageValue:q}=ie(a),x=p(null),X=p(!1),I=p(6e5),u=async()=>{try{a.setLoading(!0),a.clearError(),await new Promise(n=>setTimeout(n,1e3));const t=await o.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(t.data&&t.data.chart&&t.data.chart.result&&t.data.chart.result[0]){const n=t.data.chart.result[0];a.setVixData(n),console.log("VIX 데이터 업데이트 완료:",n)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(t){console.error("VIX 데이터 가져오기 실패:",t),a.setError(t.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{a.setLoading(!1)}},e=async(t="1mo",n=!1)=>{try{if(!n&&i.value&&D.value){const d=Date.now()-new Date(D.value).getTime();if(d<6e5)return console.log(`VIX 캐시 사용 (${Math.floor(d/1e3)}초 전 데이터)`),i.value}a.setLoading(!0),a.clearError(),await new Promise(d=>setTimeout(d,1500));const V=await o.get("/v8/finance/chart/^VIX",{params:{range:t,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(console.log("VIX API 응답 전체:",V.data),V.data&&V.data.chart&&V.data.chart.result&&V.data.chart.result[0]){const d=V.data.chart.result[0];return console.log("VIX 결과 데이터:",d),console.log("VIX 타임스탬프:",d.timestamp),console.log("VIX 인디케이터:",d.indicators),a.setVixHistoryData(d),console.log("VIX 히스토리 데이터 업데이트 완료:",d),d}else throw console.error("VIX 데이터 구조 문제:",V.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(V){return console.error("VIX 히스토리 데이터 가져오기 실패:",V),a.setError(V.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{a.setLoading(!1)}},s=()=>{x.value||(X.value=!0,x.value=setInterval(()=>{u()},I.value),console.log(`VIX 자동 새로고침 시작 (${I.value/1e3}초 간격)`))},v=()=>{x.value&&(clearInterval(x.value),x.value=null,X.value=!1,console.log("VIX 자동 새로고침 중지"))},P=t=>{I.value=t,X.value&&(v(),s())};return K(()=>{u(),s()}),W(()=>{v()}),{vixData:r,vixHistoryData:i,loading:f,error:C,lastUpdated:D,currentVix:S,vixChange:_,vixChangePercent:L,vixStatus:l,vixStatusText:m,vixStatusColor:w,chartData:y,chartLabels:b,chartValues:E,minValue:T,maxValue:A,averageValue:q,autoRefreshEnabled:X,refreshInterval:I,fetchVixData:u,fetchVixHistory:e,startAutoRefresh:s,stopAutoRefresh:v,setRefreshInterval:P,formatVixValue:t=>t==null?"N/A":t.toFixed(2),formatVixChange:t=>t==null?"N/A":`${t>=0?"+":""}${t.toFixed(2)}`,formatVixChangePercent:t=>t==null?"N/A":`${t>=0?"+":""}${t.toFixed(2)}%`,clearError:a.clearError,reset:a.reset}}const fe={class:"vix-chart-container"},me={class:"chart-header"},xe={class:"chart-title"},Ve={class:"chart-controls"},pe={key:0,class:"current-info"},ye={class:"info-card"},De={class:"status-card"},we={class:"chart-wrapper"},Ie={key:1,class:"loading-overlay"},Ce={__name:"VixChart",setup(a){Q([te,ae,oe,se,le,re]);const o=p(null),r=p(null),i=Z(),f=j(),{currentVix:C,vixChange:D,vixChangePercent:S,vixStatusText:_,vixStatusColor:L,chartData:l,chartLabels:m,chartValues:w,loading:y,fetchVixHistory:b,formatVixValue:E,formatVixChange:T,formatVixChangePercent:A}=ge(),q=async()=>{if(!o.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",o.value);try{r.value=ee(o.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",r.value),i.registerChart("vix",r.value),window.addEventListener("resize",I);const u={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};r.value.setOption(u,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작"),await b("1mo"),console.log("VIX 히스토리 데이터 로드 완료"),setTimeout(()=>{console.log("수동 차트 업데이트 시도"),console.log("chartData.value:",l.value),console.log("chartData.value?.length:",l.value?.length),console.log("vixStore.vixHistoryData:",f.vixHistoryData),console.log("vixStore.chartData:",f.chartData),l.value&&l.value.length>0?x():(console.log("아직 차트 데이터가 준비되지 않음"),setTimeout(()=>{console.log("1초 후 재시도 - chartData:",l.value),console.log("1초 후 재시도 - vixStore.chartData:",f.chartData),l.value&&l.value.length>0&&x()},1e3))},100)}catch(u){console.error("VIX 차트 초기화 실패:",u)}},x=()=>{if(!r.value){console.log("차트 인스턴스가 없습니다");return}if(!l.value||!l.value.length){console.log("차트 데이터가 없습니다:",l.value);return}console.log("차트 업데이트 시작:",{chartDataLength:l.value.length,chartLabelsLength:m.value.length,chartValuesLength:w.value.length,chartLabels:m.value.slice(0,5),chartValues:w.value.slice(0,5)});const u={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:m.value},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:w.value}]};console.log("차트 옵션:",u),r.value.setOption(u,!0)},X=async()=>{await b("1mo")},I=()=>{r.value&&r.value.resize()};return ue([l,m,w],()=>{U(()=>{console.log("watch에서 차트 업데이트 시도"),l.value&&l.value.length>0&&x()})},{deep:!0}),K(()=>{U(()=>{q()})}),W(()=>{r.value&&i.unregisterChart("vix"),window.removeEventListener("resize",I)}),(u,e)=>(z(),$("div",fe,[g("div",me,[g("div",xe,[k(G,{icon:"mdi-chart-line",class:"me-2"}),e[0]||(e[0]=F(" VIX 지수 ",-1))]),g("div",Ve,[k(ve,{variant:"text",size:"small",onClick:X,loading:c(y)},{default:O(()=>[k(G,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),c(C)!==null?(z(),$("div",pe,[g("div",ye,[e[1]||(e[1]=g("div",{class:"info-label"},"현재 VIX",-1)),g("div",{class:Y(["info-value",c(L)])},H(c(E)(c(C))),3),g("div",{class:Y(["info-change",c(D)>=0?"positive":"negative"])},H(c(T)(c(D)))+" ("+H(c(A)(c(S)))+") ",3)]),g("div",De,[e[2]||(e[2]=g("div",{class:"status-label"},"시장 상태",-1)),k(de,{color:c(L),size:"small",variant:"flat"},{default:O(()=>[F(H(c(_)),1)]),_:1},8,["color"])])])):B("",!0),g("div",we,[g("div",{ref_key:"chartRef",ref:o,class:"chart",style:{height:"400px"}},null,512)]),c(y)?(z(),$("div",Ie,[k(he,{indeterminate:"",color:"primary",size:"48"})])):B("",!0)]))}},Ee=ce(Ce,[["__scopeId","data-v-3200c749"]]);export{Ee as default};
