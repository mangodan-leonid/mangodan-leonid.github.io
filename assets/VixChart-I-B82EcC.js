import{c as j,u as J,a as Q,i as Z,b as ee,d as te,e as ae,f as oe,g as le,h as se}from"./useChartManager-CWzAW7bJ.js";import{b2 as re,r as x,d as v,b3 as ne,o as G,b4 as K,a3 as ie,y as ce,A as M,a4 as $,a5 as P,W as d,ak as B,X as A,al as F,a6 as O,av as i,a9 as U,ad as R}from"./index-BPY0Czz6.js";import{k as Y,V as ue,T as ve}from"./VBtn-yJrkKrEX.js";import{V as he}from"./WorldMapLayout-CWjrJ1kQ.js";const W=re("vix",()=>{const a=x(null),l=x(null),n=x(!1),h=x(null),g=x(null),D=v(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),C=v(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;if(!e||e.length<2)return null;const s=e[e.length-1],u=e[e.length-2];return s-u}),L=v(()=>{if(!a.value||!a.value.indicators?.quote?.[0])return null;const e=a.value.indicators.quote[0].close;if(!e||e.length<2)return null;const s=e[e.length-1],u=e[e.length-2];return(s-u)/u*100}),I=v(()=>{const e=D.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),_=v(()=>{switch(I.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),r=v(()=>{switch(I.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),f=v(()=>{if(console.log("chartData computed 실행, vixHistoryData:",l.value),!l.value||!l.value.timestamp)return console.log("차트 데이터 없음"),[];const e=l.value.timestamp||[],s=l.value.indicators?.quote?.[0]?.close||[],u=l.value.indicators?.quote?.[0]?.high||[],H=l.value.indicators?.quote?.[0]?.low||[],z=l.value.indicators?.quote?.[0]?.open||[],N=l.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:s.length,firstTimestamp:e[0],firstClose:s[0]});const T=e.map((t,o)=>({timestamp:t*1e3,date:new Date(t*1e3),close:s[o]||null,high:u[o]||null,low:H[o]||null,open:z[o]||null,volume:N[o]||null})).filter(t=>t.close!==null);return console.log("차트 데이터 결과:",T.length,"개 항목"),T}),p=v(()=>f.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),V=v(()=>f.value.map(e=>e.close)),X=v(()=>{const e=V.value.filter(s=>s!==null);return e.length>0?Math.min(...e):0}),S=v(()=>{const e=V.value.filter(s=>s!==null);return e.length>0?Math.max(...e):0}),E=v(()=>{const e=V.value.filter(s=>s!==null);return e.length>0?e.reduce((s,u)=>s+u,0)/e.length:0});return{vixData:a,vixHistoryData:l,loading:n,error:h,lastUpdated:g,currentVix:D,vixChange:C,vixChangePercent:L,vixStatus:I,vixStatusText:_,vixStatusColor:r,chartData:f,chartLabels:p,chartValues:V,minValue:X,maxValue:S,averageValue:E,setVixData:e=>{a.value=e,g.value=new Date,h.value=null},setVixHistoryData:e=>{l.value=e,g.value=new Date,h.value=null},setLoading:e=>{n.value=e},setError:e=>{h.value=e,n.value=!1},clearError:()=>{h.value=null},reset:()=>{a.value=null,l.value=null,n.value=!1,h.value=null,g.value=null}}});function de(){const a=W(),l=j(),{vixData:n,vixHistoryData:h,loading:g,error:D,lastUpdated:C,currentVix:L,vixChange:I,vixChangePercent:_,vixStatus:r,vixStatusText:f,vixStatusColor:p,chartData:V,chartLabels:X,chartValues:S,minValue:E,maxValue:k,averageValue:q}=ne(a),m=x(null),w=x(!1),y=x(6e4),c=async()=>{try{a.setLoading(!0),a.clearError();const t=await l.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(t.data&&t.data.chart&&t.data.chart.result&&t.data.chart.result[0]){const o=t.data.chart.result[0];a.setVixData(o),console.log("VIX 데이터 업데이트 완료:",o)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(t){console.error("VIX 데이터 가져오기 실패:",t),a.setError(t.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{a.setLoading(!1)}},e=async(t="1mo")=>{try{a.setLoading(!0),a.clearError();const o=await l.get("/v8/finance/chart/^VIX",{params:{range:t,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(console.log("VIX API 응답 전체:",o.data),o.data&&o.data.chart&&o.data.chart.result&&o.data.chart.result[0]){const b=o.data.chart.result[0];return console.log("VIX 결과 데이터:",b),console.log("VIX 타임스탬프:",b.timestamp),console.log("VIX 인디케이터:",b.indicators),a.setVixHistoryData(b),console.log("VIX 히스토리 데이터 업데이트 완료:",b),b}else throw console.error("VIX 데이터 구조 문제:",o.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(o){return console.error("VIX 히스토리 데이터 가져오기 실패:",o),a.setError(o.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{a.setLoading(!1)}},s=()=>{m.value||(w.value=!0,m.value=setInterval(()=>{c()},y.value),console.log(`VIX 자동 새로고침 시작 (${y.value/1e3}초 간격)`))},u=()=>{m.value&&(clearInterval(m.value),m.value=null,w.value=!1,console.log("VIX 자동 새로고침 중지"))},H=t=>{y.value=t,w.value&&(u(),s())};return G(()=>{c(),s()}),K(()=>{u()}),{vixData:n,vixHistoryData:h,loading:g,error:D,lastUpdated:C,currentVix:L,vixChange:I,vixChangePercent:_,vixStatus:r,vixStatusText:f,vixStatusColor:p,chartData:V,chartLabels:X,chartValues:S,minValue:E,maxValue:k,averageValue:q,autoRefreshEnabled:w,refreshInterval:y,fetchVixData:c,fetchVixHistory:e,startAutoRefresh:s,stopAutoRefresh:u,setRefreshInterval:H,formatVixValue:t=>t==null?"N/A":t.toFixed(2),formatVixChange:t=>t==null?"N/A":`${t>=0?"+":""}${t.toFixed(2)}`,formatVixChangePercent:t=>t==null?"N/A":`${t>=0?"+":""}${t.toFixed(2)}%`,clearError:a.clearError,reset:a.reset}}const ge={class:"vix-chart-container"},fe={class:"chart-header"},me={class:"chart-title"},xe={class:"chart-controls"},Ve={key:0,class:"current-info"},pe={class:"info-card"},ye={class:"status-card"},De={class:"chart-wrapper"},Ie={key:1,class:"loading-overlay"},we={__name:"VixChart",setup(a){J([ee,te,ae,oe,le,se]);const l=x(null),n=x(null),h=Q(),g=W(),{currentVix:D,vixChange:C,vixChangePercent:L,vixStatusText:I,vixStatusColor:_,chartData:r,chartLabels:f,chartValues:p,loading:V,fetchVixHistory:X,formatVixValue:S,formatVixChange:E,formatVixChangePercent:k}=de(),q=async()=>{if(!l.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",l.value);try{n.value=Z(l.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",n.value),h.registerChart("vix",n.value),window.addEventListener("resize",y);const c={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};n.value.setOption(c,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작"),await X("1mo"),console.log("VIX 히스토리 데이터 로드 완료"),setTimeout(()=>{console.log("수동 차트 업데이트 시도"),console.log("chartData.value:",r.value),console.log("chartData.value?.length:",r.value?.length),console.log("vixStore.vixHistoryData:",g.vixHistoryData),console.log("vixStore.chartData:",g.chartData),r.value&&r.value.length>0?m():(console.log("아직 차트 데이터가 준비되지 않음"),setTimeout(()=>{console.log("1초 후 재시도 - chartData:",r.value),console.log("1초 후 재시도 - vixStore.chartData:",g.chartData),r.value&&r.value.length>0&&m()},1e3))},100)}catch(c){console.error("VIX 차트 초기화 실패:",c)}},m=()=>{if(!n.value){console.log("차트 인스턴스가 없습니다");return}if(!r.value||!r.value.length){console.log("차트 데이터가 없습니다:",r.value);return}console.log("차트 업데이트 시작:",{chartDataLength:r.value.length,chartLabelsLength:f.value.length,chartValuesLength:p.value.length,chartLabels:f.value.slice(0,5),chartValues:p.value.slice(0,5)});const c={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:f.value},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:p.value}]};console.log("차트 옵션:",c),n.value.setOption(c,!0)},w=async()=>{await X("1mo")},y=()=>{n.value&&n.value.resize()};return ce([r,f,p],()=>{M(()=>{console.log("watch에서 차트 업데이트 시도"),r.value&&r.value.length>0&&m()})},{deep:!0}),G(()=>{M(()=>{q()})}),K(()=>{n.value&&h.unregisterChart("vix"),window.removeEventListener("resize",y)}),(c,e)=>(P(),$("div",ge,[d("div",fe,[d("div",me,[A(Y,{icon:"mdi-chart-line",class:"me-2"}),e[0]||(e[0]=F(" VIX 지수 ",-1))]),d("div",xe,[A(ue,{variant:"text",size:"small",onClick:w,loading:i(V)},{default:O(()=>[A(Y,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),i(D)!==null?(P(),$("div",Ve,[d("div",pe,[e[1]||(e[1]=d("div",{class:"info-label"},"현재 VIX",-1)),d("div",{class:U(["info-value",i(_)])},R(i(S)(i(D))),3),d("div",{class:U(["info-change",i(C)>=0?"positive":"negative"])},R(i(E)(i(C)))+" ("+R(i(k)(i(L)))+") ",3)]),d("div",ye,[e[2]||(e[2]=d("div",{class:"status-label"},"시장 상태",-1)),A(he,{color:i(_),size:"small",variant:"flat"},{default:O(()=>[F(R(i(I)),1)]),_:1},8,["color"])])])):B("",!0),d("div",De,[d("div",{ref_key:"chartRef",ref:l,class:"chart",style:{height:"400px"}},null,512)]),i(V)?(P(),$("div",Ie,[A(ve,{indeterminate:"",color:"primary",size:"48"})])):B("",!0)]))}},Le=ie(we,[["__scopeId","data-v-3200c749"]]);export{Le as default};
