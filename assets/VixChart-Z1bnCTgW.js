import{c as ee,u as te,i as oe,a as le,b as ae,d as ne,e as se,f as re,g as ce,V as ie,h as ue}from"./WorldMapLayout-CF6ljfQR.js";import{ax as ge,r as y,d as m,ay as he,o as J,az as Q,a3 as ve,y as de,A as B,a4 as F,a5 as O,W as V,ak as Y,X as k,al as G,a6 as K,av as d,a9 as W,ad as M}from"./index-DajpdiVC.js";import{k as j,V as me,T as fe}from"./VBtn-BYkvbcVV.js";const Z=ge("vix",()=>{const n=y(null),u=y(null),g=y(!1),v=y(null),w=y(null),_=m(()=>{if(!n.value||!n.value.indicators?.quote?.[0])return null;const e=n.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),I=m(()=>{if(!n.value||!n.value.indicators?.quote?.[0])return null;const e=n.value.indicators.quote[0].close;if(!e||e.length<2)return null;const l=e[e.length-1],a=e[e.length-2];return l-a}),A=m(()=>{if(!n.value||!n.value.indicators?.quote?.[0])return null;const e=n.value.indicators.quote[0].close;if(!e||e.length<2)return null;const l=e[e.length-1],a=e[e.length-2];return(l-a)/a*100}),b=m(()=>{const e=_.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),U=m(()=>{switch(b.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),t=m(()=>{switch(b.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),f=m(()=>{if(console.log("chartData computed 실행, vixHistoryData:",u.value),!u.value||!u.value.timestamp)return console.log("차트 데이터 없음"),[];const e=u.value.timestamp||[],l=u.value.indicators?.quote?.[0]?.close||[],a=u.value.indicators?.quote?.[0]?.high||[],D=u.value.indicators?.quote?.[0]?.low||[],$=u.value.indicators?.quote?.[0]?.open||[],z=u.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:l.length,firstTimestamp:e[0],firstClose:l[0],lastTimestamp:e[e.length-1],lastClose:l[l.length-1],nullCount:l.filter(o=>o===null).length,undefinedCount:l.filter(o=>o===void 0).length});const s=e.map((o,r)=>({timestamp:o*1e3,date:new Date(o*1e3),close:l[r]!==null&&l[r]!==void 0?l[r]:null,high:a[r]!==null&&a[r]!==void 0?a[r]:null,low:D[r]!==null&&D[r]!==void 0?D[r]:null,open:$[r]!==null&&$[r]!==void 0?$[r]:null,volume:z[r]!==null&&z[r]!==void 0?z[r]:null})).filter(o=>o.close!==null&&o.close!==void 0);if(console.log("차트 데이터 결과:",{totalItems:s.length,firstItem:s[0],lastItem:s[s.length-1],dateRange:s.length>0?`${s[0].date.toLocaleDateString()} ~ ${s[s.length-1].date.toLocaleDateString()}`:"none"}),s.length>0){console.log("=== 차트 데이터 상세 분석 ==="),console.log("전체 데이터 포인트:",s.length),console.log("첫 번째 데이터:",{timestamp:s[0].timestamp,date:s[0].date.toLocaleDateString(),close:s[0].close}),console.log("마지막 데이터:",{timestamp:s[s.length-1].timestamp,date:s[s.length-1].date.toLocaleDateString(),close:s[s.length-1].close}),console.log("처음 5개 데이터:",s.slice(0,5).map(h=>({date:h.date.toLocaleDateString(),close:h.close}))),console.log("마지막 5개 데이터:",s.slice(-5).map(h=>({date:h.date.toLocaleDateString(),close:h.close})));const o=new Date(s[0].timestamp),r=new Date(s[s.length-1].timestamp),X=Math.ceil((r-o)/(1e3*60*60*24));console.log("날짜 범위 (일수):",X),console.log("=== 차트 데이터 분석 끝 ===")}return s}),L=m(()=>f.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),C=m(()=>f.value.map(e=>e.close)),T=m(()=>{const e=C.value.filter(l=>l!==null);return e.length>0?Math.min(...e):0}),E=m(()=>{const e=C.value.filter(l=>l!==null);return e.length>0?Math.max(...e):0}),q=m(()=>{const e=C.value.filter(l=>l!==null);return e.length>0?e.reduce((l,a)=>l+a,0)/e.length:0});return{vixData:n,vixHistoryData:u,loading:g,error:v,lastUpdated:w,currentVix:_,vixChange:I,vixChangePercent:A,vixStatus:b,vixStatusText:U,vixStatusColor:t,chartData:f,chartLabels:L,chartValues:C,minValue:T,maxValue:E,averageValue:q,setVixData:e=>{n.value=e,w.value=new Date,v.value=null},setVixHistoryData:e=>{u.value=e,w.value=new Date,v.value=null},setLoading:e=>{g.value=e},setError:e=>{v.value=e,g.value=!1},clearError:()=>{v.value=null},reset:()=>{n.value=null,u.value=null,g.value=!1,v.value=null,w.value=null}}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function pe(){const n=Z(),u=ee(),{vixData:g,vixHistoryData:v,loading:w,error:_,lastUpdated:I,currentVix:A,vixChange:b,vixChangePercent:U,vixStatus:t,vixStatusText:f,vixStatusColor:L,chartData:C,chartLabels:T,chartValues:E,minValue:q,maxValue:H,averageValue:N}=he(n),p=y(null),R=y(!1),S=y(6e5),i=async()=>{try{n.setLoading(!0),n.clearError(),await new Promise(r=>setTimeout(r,1e3));const o=await u.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(o.data&&o.data.chart&&o.data.chart.result&&o.data.chart.result[0]){const r=o.data.chart.result[0];n.setVixData(r),console.log("VIX 데이터 업데이트 완료:",r)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(o){console.error("VIX 데이터 가져오기 실패:",o),n.setError(o.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{n.setLoading(!1)}},e=async(o="1mo",r=!1)=>{try{if(!r&&v.value&&I.value){const c=Date.now()-new Date(I.value).getTime();if(c<6e5)return console.log(`VIX 캐시 사용 (${Math.floor(c/1e3)}초 전 데이터)`),v.value}n.setLoading(!0),n.clearError(),await new Promise(c=>setTimeout(c,1500));const X={range:o,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"};console.log("=== API 요청 파라미터 ==="),console.log("요청 파라미터:",X),console.log("요청 URL:",u.defaults.baseURL+"/v8/finance/chart/^VIX"),console.log("전체 요청 URL:",u.defaults.baseURL+"/v8/finance/chart/^VIX?"+new URLSearchParams(X).toString()),console.log("=== API 요청 파라미터 끝 ===");let h;{const c=`https://query1.finance.yahoo.com/v8/finance/chart/^VIX?${new URLSearchParams(X).toString()}`,x=`https://api.allorigins.win/raw?url=${encodeURIComponent(c)}`;console.log("프로덕션 직접 URL:",c),console.log("프로덕션 프록시 URL:",x),h=await fetch(x),h={data:await h.json()}}if(console.log("VIX API 응답 전체:",h.data),h.data&&h.data.chart&&h.data.chart.result&&h.data.chart.result[0]){const c=h.data.chart.result[0];if(console.log("VIX 결과 데이터:",c),console.log("VIX 타임스탬프:",c.timestamp),console.log("VIX 인디케이터:",c.indicators),console.log("=== 배포 환경 디버깅 정보 ==="),console.log("타임스탬프 개수:",c.timestamp?.length),console.log("첫 번째 타임스탬프:",c.timestamp?.[0]),console.log("마지막 타임스탬프:",c.timestamp?.[c.timestamp?.length-1]),console.log("첫 번째 날짜:",c.timestamp?.[0]?new Date(c.timestamp[0]*1e3).toLocaleDateString():"N/A"),console.log("마지막 날짜:",c.timestamp?.[c.timestamp?.length-1]?new Date(c.timestamp[c.timestamp.length-1]*1e3).toLocaleDateString():"N/A"),c.indicators?.quote?.[0]){const x=c.indicators.quote[0];console.log("Close 데이터 개수:",x.close?.length),console.log("첫 번째 Close 값:",x.close?.[0]),console.log("마지막 Close 값:",x.close?.[x.close?.length-1]),console.log("Null 값 개수:",x.close?.filter(P=>P===null).length),console.log("Undefined 값 개수:",x.close?.filter(P=>P===void 0).length),console.log("유효한 값 개수:",x.close?.filter(P=>P!=null).length)}return console.log("=== 디버깅 정보 끝 ==="),n.setVixHistoryData(c),console.log("VIX 히스토리 데이터 업데이트 완료:",c),c}else throw console.error("VIX 데이터 구조 문제:",h.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(X){return console.error("VIX 히스토리 데이터 가져오기 실패:",X),n.setError(X.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{n.setLoading(!1)}},l=()=>{p.value||(R.value=!0,p.value=setInterval(()=>{i()},S.value),console.log(`VIX 자동 새로고침 시작 (${S.value/1e3}초 간격)`))},a=()=>{p.value&&(clearInterval(p.value),p.value=null,R.value=!1,console.log("VIX 자동 새로고침 중지"))},D=o=>{S.value=o,R.value&&(a(),l())};return J(()=>{i(),l()}),Q(()=>{a()}),{vixData:g,vixHistoryData:v,loading:w,error:_,lastUpdated:I,currentVix:A,vixChange:b,vixChangePercent:U,vixStatus:t,vixStatusText:f,vixStatusColor:L,chartData:C,chartLabels:T,chartValues:E,minValue:q,maxValue:H,averageValue:N,autoRefreshEnabled:R,refreshInterval:S,fetchVixData:i,fetchVixHistory:e,startAutoRefresh:l,stopAutoRefresh:a,setRefreshInterval:D,formatVixValue:o=>o==null?"N/A":o.toFixed(2),formatVixChange:o=>o==null?"N/A":`${o>=0?"+":""}${o.toFixed(2)}`,formatVixChangePercent:o=>o==null?"N/A":`${o>=0?"+":""}${o.toFixed(2)}%`,clearError:n.clearError,reset:n.reset}}const xe={class:"vix-chart-container"},Ve={class:"chart-header"},De={class:"chart-title"},ye={class:"chart-controls"},we={key:0,class:"current-info"},Le={class:"info-card"},Ce={class:"status-card"},Ie={class:"chart-wrapper"},Se={key:1,class:"loading-overlay"},Xe={__name:"VixChart",setup(n){te([oe,le,ae,ne,se,re]);const u=y(null),g=y(null),v=ce(),w=Z(),{currentVix:_,vixChange:I,vixChangePercent:A,vixStatusText:b,vixStatusColor:U,chartData:t,chartLabels:f,chartValues:L,loading:C,fetchVixHistory:T,formatVixValue:E,formatVixChange:q,formatVixChangePercent:H}=pe(),N=async()=>{if(!u.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",u.value),console.log("=== 환경 정보 ==="),console.log("개발 환경:",!1),console.log("프로덕션 환경:",!0),console.log("현재 URL:",window.location.href),console.log("User Agent:",navigator.userAgent),console.log("=== 환경 정보 끝 ===");try{g.value=ue(u.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",g.value),v.registerChart("vix",g.value),window.addEventListener("resize",S);const i={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};g.value.setOption(i,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작 1mo"),await T("1mo"),console.log("VIX 히스토리 데이터 로드 완료 1mo");const e=(l=1,a=5)=>{console.log(`차트 업데이트 시도 ${l}/${a}`),console.log("chartData.value:",t.value),console.log("chartData.value?.length:",t.value?.length),console.log("vixStore.vixHistoryData:",w.vixHistoryData),console.log("vixStore.chartData:",w.chartData),t.value&&t.value.length>0?(p(),console.log(`차트 업데이트 성공 (시도 ${l})`)):l<a?(console.log(`차트 데이터가 아직 준비되지 않음, ${500*l}ms 후 재시도`),setTimeout(()=>{e(l+1,a)},500*l)):console.log("최대 시도 횟수 초과, 차트 업데이트 실패")};setTimeout(()=>{e()},100)}catch(i){console.error("VIX 차트 초기화 실패:",i)}},p=()=>{if(!g.value){console.log("차트 인스턴스가 없습니다");return}if(!t.value||!t.value.length){console.log("차트 데이터가 없습니다:",t.value);return}if(console.log("차트 업데이트 시작:",{chartDataLength:t.value.length,chartLabelsLength:f.value.length,chartValuesLength:L.value.length,chartLabels:f.value.slice(0,5),chartValues:L.value.slice(0,5),firstDataPoint:t.value[0],lastDataPoint:t.value[t.value.length-1]}),console.log("=== 차트 렌더링 디버깅 ==="),console.log("차트 인스턴스 존재:",!!g.value),console.log("차트 데이터 존재:",!!t.value),console.log("차트 데이터 길이:",t.value?.length),console.log("차트 라벨 길이:",f.value?.length),console.log("차트 값 길이:",L.value?.length),t.value&&t.value.length>0){console.log("첫 번째 차트 데이터:",{timestamp:t.value[0].timestamp,date:t.value[0].date.toLocaleDateString(),close:t.value[0].close}),console.log("마지막 차트 데이터:",{timestamp:t.value[t.value.length-1].timestamp,date:t.value[t.value.length-1].date.toLocaleDateString(),close:t.value[t.value.length-1].close});const a=new Date(t.value[0].timestamp),D=new Date(t.value[t.value.length-1].timestamp),$=Math.ceil((D-a)/(1e3*60*60*24));console.log("차트 날짜 범위 (일수):",$)}console.log("=== 차트 렌더링 디버깅 끝 ===");const i=L.value.filter(a=>a!=null),e=f.value.slice(0,i.length);console.log("유효한 데이터:",{validDataLength:i.length,validLabelsLength:e.length,validDataRange:i.length>0?`${i[0]} ~ ${i[i.length-1]}`:"none"});const l={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis",formatter:function(a){const D=a[0];return`${new Date(D.axisValue).toLocaleDateString("ko-KR")}<br/>VIX: ${D.value.toFixed(2)}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e},yAxis:{type:"value",min:function(a){return Math.max(0,a.min*.9)},max:function(a){return a.max*1.1}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:i}]};console.log("차트 옵션:",l),g.value.setOption(l,!0),console.log("차트 업데이트 완료"),setTimeout(()=>{console.log("=== 차트 렌더링 후 확인 ===");const a=g.value.getOption();console.log("실제 차트에 설정된 데이터 개수:",a.series?.[0]?.data?.length),console.log("실제 차트에 설정된 라벨 개수:",a.xAxis?.[0]?.data?.length),console.log("차트 크기:",g.value.getWidth(),"x",g.value.getHeight()),console.log("=== 차트 렌더링 확인 끝 ===")},100)},R=async()=>{console.log("새로고침 시작 - 강제 데이터 갱신");try{await T("1mo",!0),setTimeout(()=>{console.log("새로고침 후 차트 업데이트 시도"),console.log("새로고침 후 chartData:",t.value),console.log("새로고침 후 chartData.length:",t.value?.length),t.value&&t.value.length>0?(p(),console.log("새로고침 후 차트 업데이트 완료")):(console.log("새로고침 후에도 차트 데이터가 없음"),setTimeout(()=>{t.value&&t.value.length>0&&(p(),console.log("재시도 후 차트 업데이트 완료"))},500))},200)}catch(i){console.error("새로고침 중 오류:",i)}},S=()=>{g.value&&g.value.resize()};return de([t,f,L],(i,e)=>{console.log("watch 트리거됨:",{newChartDataLength:i[0]?.length,newChartLabelsLength:i[1]?.length,newChartValuesLength:i[2]?.length,oldChartDataLength:e?.[0]?.length}),B(()=>{console.log("watch에서 차트 업데이트 시도"),t.value&&t.value.length>0?(p(),console.log("watch에서 차트 업데이트 완료")):console.log("watch에서 차트 데이터가 없음")})},{deep:!0,immediate:!1}),J(()=>{B(()=>{N()})}),Q(()=>{g.value&&v.unregisterChart("vix"),window.removeEventListener("resize",S)}),(i,e)=>(O(),F("div",xe,[V("div",Ve,[V("div",De,[k(j,{icon:"mdi-chart-line",class:"me-2"}),e[0]||(e[0]=G(" VIX 지수 ",-1))]),V("div",ye,[k(me,{variant:"text",size:"small",onClick:R,loading:d(C)},{default:K(()=>[k(j,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),d(_)!==null?(O(),F("div",we,[V("div",Le,[e[1]||(e[1]=V("div",{class:"info-label"},"현재 VIX",-1)),V("div",{class:W(["info-value",d(U)])},M(d(E)(d(_))),3),V("div",{class:W(["info-change",d(I)>=0?"positive":"negative"])},M(d(q)(d(I)))+" ("+M(d(H)(d(A)))+") ",3)]),V("div",Ce,[e[2]||(e[2]=V("div",{class:"status-label"},"시장 상태",-1)),k(ie,{color:d(U),size:"small",variant:"flat"},{default:K(()=>[G(M(d(b)),1)]),_:1},8,["color"])])])):Y("",!0),V("div",Ie,[V("div",{ref_key:"chartRef",ref:u,class:"chart",style:{height:"400px"}},null,512)]),d(C)?(O(),F("div",Se,[k(fe,{indeterminate:"",color:"primary",size:"48"})])):Y("",!0)]))}},$e=ve(Xe,[["__scopeId","data-v-dfe1d521"]]);export{$e as default};
