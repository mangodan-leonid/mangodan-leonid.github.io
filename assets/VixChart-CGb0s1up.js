import{c as ae,u as le,i as ne,a as se,b as re,d as ce,e as ie,f as ue,g as ge,V as he,h as ve}from"./WorldMapLayout-C-XGPOfs.js";import{ax as de,r as L,d as D,ay as me,o as Z,az as ee,a3 as fe,y as pe,A as G,a4 as B,a5 as Y,W as I,ak as K,X as N,al as W,a6 as j,av as p,a9 as J,ad as O}from"./index-Mp8fKD_a.js";import{k as Q,V as Ve,T as xe}from"./VBtn-CGZk8AFc.js";const te=de("vix",()=>{const r=L(null),i=L(null),u=L(!1),V=L(null),w=L(null),A=D(()=>{if(!r.value||!r.value.indicators?.quote?.[0])return null;const e=r.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),C=D(()=>{if(!r.value||!r.value.indicators?.quote?.[0])return null;const e=r.value.indicators.quote[0].close;if(!e||e.length<2)return null;const l=e[e.length-1],d=e[e.length-2];return l-d}),q=D(()=>{if(!r.value||!r.value.indicators?.quote?.[0])return null;const e=r.value.indicators.quote[0].close;if(!e||e.length<2)return null;const l=e[e.length-1],d=e[e.length-2];return(l-d)/d*100}),P=D(()=>{const e=A.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),R=D(()=>{switch(P.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),t=D(()=>{switch(P.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),y=D(()=>{if(console.log("chartData computed 실행, vixHistoryData:",i.value),!i.value||!i.value.timestamp)return console.log("차트 데이터 없음"),[];const e=i.value.timestamp||[],l=i.value.indicators?.quote?.[0]?.close||[],d=i.value.indicators?.quote?.[0]?.high||[],z=i.value.indicators?.quote?.[0]?.low||[],F=i.value.indicators?.quote?.[0]?.open||[],n=i.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:l.length,firstTimestamp:e[0],firstClose:l[0],lastTimestamp:e[e.length-1],lastClose:l[l.length-1],nullCount:l.filter(g=>g===null).length,undefinedCount:l.filter(g=>g===void 0).length});const o=e.map((g,s)=>({timestamp:g*1e3,date:new Date(g*1e3),close:l[s]!==null&&l[s]!==void 0?l[s]:null,high:d[s]!==null&&d[s]!==void 0?d[s]:null,low:z[s]!==null&&z[s]!==void 0?z[s]:null,open:F[s]!==null&&F[s]!==void 0?F[s]:null,volume:n[s]!==null&&n[s]!==void 0?n[s]:null})).filter(g=>g.close!==null&&g.close!==void 0);if(console.log("차트 데이터 결과:",{totalItems:o.length,firstItem:o[0],lastItem:o[o.length-1],dateRange:o.length>0?`${o[0].date.toLocaleDateString()} ~ ${o[o.length-1].date.toLocaleDateString()}`:"none"}),o.length>0){console.log("=== 차트 데이터 상세 분석 ==="),console.log("전체 데이터 포인트:",o.length),console.log("첫 번째 데이터:",{timestamp:o[0].timestamp,date:o[0].date.toLocaleDateString(),close:o[0].close}),console.log("마지막 데이터:",{timestamp:o[o.length-1].timestamp,date:o[o.length-1].date.toLocaleDateString(),close:o[o.length-1].close}),console.log("처음 5개 데이터:",o.slice(0,5).map(_=>({date:_.date.toLocaleDateString(),close:_.close}))),console.log("마지막 5개 데이터:",o.slice(-5).map(_=>({date:_.date.toLocaleDateString(),close:_.close})));const g=new Date(o[0].timestamp),s=new Date(o[o.length-1].timestamp),U=Math.ceil((s-g)/(1e3*60*60*24));console.log("날짜 범위 (일수):",U),console.log("=== 차트 데이터 분석 끝 ===")}return o}),S=D(()=>y.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),X=D(()=>y.value.map(e=>e.close)),T=D(()=>{const e=X.value.filter(l=>l!==null);return e.length>0?Math.min(...e):0}),E=D(()=>{const e=X.value.filter(l=>l!==null);return e.length>0?Math.max(...e):0}),k=D(()=>{const e=X.value.filter(l=>l!==null);return e.length>0?e.reduce((l,d)=>l+d,0)/e.length:0}),M=e=>{r.value=e,w.value=new Date,V.value=null},H=e=>{i.value=e,w.value=new Date,V.value=null},x=e=>{u.value=e},b=e=>{V.value=e,u.value=!1},$=()=>{V.value=null},c=()=>{if(!w.value)return!1;const e=new Date(w.value);return new Date().getTime()-e.getTime()<3600*1e3};return{vixData:r,vixHistoryData:i,loading:u,error:V,lastUpdated:w,currentVix:A,vixChange:C,vixChangePercent:q,vixStatus:P,vixStatusText:R,vixStatusColor:t,chartData:y,chartLabels:S,chartValues:X,minValue:T,maxValue:E,averageValue:k,setVixData:M,setVixHistoryData:H,setLoading:x,setError:b,clearError:$,reset:()=>{r.value=null,i.value=null,u.value=!1,V.value=null,w.value=null},isCacheValid:c,hasValidCache:()=>i.value&&i.value.timestamp&&i.value.timestamp.length>0&&c()}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function De(){const r=te(),i=ae(),{vixData:u,vixHistoryData:V,loading:w,error:A,lastUpdated:C,currentVix:q,vixChange:P,vixChangePercent:R,vixStatus:t,vixStatusText:y,vixStatusColor:S,chartData:X,chartLabels:T,chartValues:E,minValue:k,maxValue:M,averageValue:H}=me(r),x=L(null),b=L(!1),$=L(3600*1e3),c=async()=>{try{r.setLoading(!0),r.clearError(),await new Promise(o=>setTimeout(o,1e3));const n=await i.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(n.data&&n.data.chart&&n.data.chart.result&&n.data.chart.result[0]){const o=n.data.chart.result[0];r.setVixData(o),console.log("VIX 데이터 업데이트 완료:",o)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(n){console.error("VIX 데이터 가져오기 실패:",n),r.setError(n.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{r.setLoading(!1)}},h=async(n="1mo",o=!1)=>{try{if(!o&&r.hasValidCache()){const a=Date.now()-new Date(C.value).getTime(),v=Math.floor(a/(60*1e3)),f=Math.floor((3600*1e3-a)/(60*1e3));return console.log(`VIX 캐시 사용 (${v}분 전 데이터, ${f}분 후 갱신 예정)`),V.value}else if(!o&&C.value){const a=Date.now()-new Date(C.value).getTime(),v=Math.floor(a/(3600*1e3));console.log(`VIX 캐시 만료 (${v}시간 전 데이터), API 호출`)}else o||console.log("VIX 캐시 없음, API 호출");r.setLoading(!0),r.clearError(),await new Promise(a=>setTimeout(a,2e3));const g={range:n,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"};console.log("=== API 요청 파라미터 ==="),console.log("요청 파라미터:",g),console.log("요청 URL:",i.defaults.baseURL+"/v8/finance/chart/^VIX"),console.log("전체 요청 URL:",i.defaults.baseURL+"/v8/finance/chart/^VIX?"+new URLSearchParams(g).toString()),console.log("=== API 요청 파라미터 끝 ===");let s;const U=3;let _=null;for(let a=1;a<=U;a++)try{console.log(`VIX API 요청 시도 ${a}/${U}`);{const v=`https://query1.finance.yahoo.com/v8/finance/chart/^VIX?${new URLSearchParams(g).toString()}`,f=`https://api.allorigins.win/raw?url=${encodeURIComponent(v)}`;console.log("프로덕션 직접 URL:",v),console.log("프로덕션 프록시 URL:",f),s=await fetch(f),s={data:await s.json()}}break}catch(v){if(_=v,console.error(`VIX API 요청 실패 (시도 ${a}/${U}):`,v),a<U){const f=2e3*Math.pow(2,a-1);console.log(`${f}ms 후 재시도...`),await new Promise(oe=>setTimeout(oe,f))}}if(_&&!s)throw _;if(console.log("VIX API 응답 전체:",s.data),s.data&&s.data.chart&&s.data.chart.result&&s.data.chart.result[0]){const a=s.data.chart.result[0];if(console.log("VIX 결과 데이터:",a),console.log("VIX 타임스탬프:",a.timestamp),console.log("VIX 인디케이터:",a.indicators),console.log("=== 배포 환경 디버깅 정보 ==="),console.log("타임스탬프 개수:",a.timestamp?.length),console.log("첫 번째 타임스탬프:",a.timestamp?.[0]),console.log("마지막 타임스탬프:",a.timestamp?.[a.timestamp?.length-1]),console.log("첫 번째 날짜:",a.timestamp?.[0]?new Date(a.timestamp[0]*1e3).toLocaleDateString():"N/A"),console.log("마지막 날짜:",a.timestamp?.[a.timestamp?.length-1]?new Date(a.timestamp[a.timestamp.length-1]*1e3).toLocaleDateString():"N/A"),a.indicators?.quote?.[0]){const v=a.indicators.quote[0];console.log("Close 데이터 개수:",v.close?.length),console.log("첫 번째 Close 값:",v.close?.[0]),console.log("마지막 Close 값:",v.close?.[v.close?.length-1]),console.log("Null 값 개수:",v.close?.filter(f=>f===null).length),console.log("Undefined 값 개수:",v.close?.filter(f=>f===void 0).length),console.log("유효한 값 개수:",v.close?.filter(f=>f!=null).length)}return console.log("=== 디버깅 정보 끝 ==="),r.setVixHistoryData(a),console.log("VIX 히스토리 데이터 업데이트 완료:",a),a}else throw console.error("VIX 데이터 구조 문제:",s.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(g){return console.error("VIX 히스토리 데이터 가져오기 실패:",g),r.setError(g.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{r.setLoading(!1)}},m=()=>{x.value||(b.value=!0,x.value=setInterval(()=>{c()},$.value),console.log(`VIX 자동 새로고침 시작 (${$.value/(60*1e3)}분 간격)`))},e=()=>{x.value&&(clearInterval(x.value),x.value=null,b.value=!1,console.log("VIX 자동 새로고침 중지"))},l=n=>{$.value=n,b.value&&(e(),m())};return Z(()=>{c(),m()}),ee(()=>{e()}),{vixData:u,vixHistoryData:V,loading:w,error:A,lastUpdated:C,currentVix:q,vixChange:P,vixChangePercent:R,vixStatus:t,vixStatusText:y,vixStatusColor:S,chartData:X,chartLabels:T,chartValues:E,minValue:k,maxValue:M,averageValue:H,autoRefreshEnabled:b,refreshInterval:$,fetchVixData:c,fetchVixHistory:h,startAutoRefresh:m,stopAutoRefresh:e,setRefreshInterval:l,formatVixValue:n=>n==null?"N/A":n.toFixed(2),formatVixChange:n=>n==null?"N/A":`${n>=0?"+":""}${n.toFixed(2)}`,formatVixChangePercent:n=>n==null?"N/A":`${n>=0?"+":""}${n.toFixed(2)}%`,clearError:r.clearError,reset:r.reset}}const we={class:"vix-chart-container"},ye={class:"chart-header"},Ie={class:"chart-title"},Le={class:"chart-controls"},Ce={key:0,class:"current-info"},Se={class:"info-card"},Xe={class:"status-card"},$e={class:"chart-wrapper"},_e={key:1,class:"loading-overlay"},be={__name:"VixChart",setup(r){le([ne,se,re,ce,ie,ue]);const i=L(null),u=L(null),V=ge(),w=te(),{currentVix:A,vixChange:C,vixChangePercent:q,vixStatusText:P,vixStatusColor:R,chartData:t,chartLabels:y,chartValues:S,loading:X,fetchVixHistory:T,formatVixValue:E,formatVixChange:k,formatVixChangePercent:M}=De(),H=async()=>{if(!i.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",i.value),console.log("=== 환경 정보 ==="),console.log("개발 환경:",!1),console.log("프로덕션 환경:",!0),console.log("현재 URL:",window.location.href),console.log("User Agent:",navigator.userAgent),console.log("=== 환경 정보 끝 ===");try{u.value=ve(i.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",u.value),V.registerChart("vix",u.value),window.addEventListener("resize",$);const c={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};u.value.setOption(c,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작 1mo"),await T("1mo"),console.log("VIX 히스토리 데이터 로드 완료 1mo");const h=(m=1,e=5)=>{console.log(`차트 업데이트 시도 ${m}/${e}`),console.log("chartData.value:",t.value),console.log("chartData.value?.length:",t.value?.length),console.log("vixStore.vixHistoryData:",w.vixHistoryData),console.log("vixStore.chartData:",w.chartData),t.value&&t.value.length>0?(x(),console.log(`차트 업데이트 성공 (시도 ${m})`)):m<e?(console.log(`차트 데이터가 아직 준비되지 않음, ${500*m}ms 후 재시도`),setTimeout(()=>{h(m+1,e)},500*m)):console.log("최대 시도 횟수 초과, 차트 업데이트 실패")};setTimeout(()=>{h()},100)}catch(c){console.error("VIX 차트 초기화 실패:",c)}},x=()=>{if(!u.value){console.log("차트 인스턴스가 없습니다");return}if(!t.value||!t.value.length){console.log("차트 데이터가 없습니다:",t.value);return}if(console.log("차트 업데이트 시작:",{chartDataLength:t.value.length,chartLabelsLength:y.value.length,chartValuesLength:S.value.length,chartLabels:y.value.slice(0,5),chartValues:S.value.slice(0,5),firstDataPoint:t.value[0],lastDataPoint:t.value[t.value.length-1]}),console.log("=== 차트 렌더링 디버깅 ==="),console.log("차트 인스턴스 존재:",!!u.value),console.log("차트 데이터 존재:",!!t.value),console.log("차트 데이터 길이:",t.value?.length),console.log("차트 라벨 길이:",y.value?.length),console.log("차트 값 길이:",S.value?.length),t.value&&t.value.length>0){console.log("첫 번째 차트 데이터:",{timestamp:t.value[0].timestamp,date:t.value[0].date.toLocaleDateString(),close:t.value[0].close}),console.log("마지막 차트 데이터:",{timestamp:t.value[t.value.length-1].timestamp,date:t.value[t.value.length-1].date.toLocaleDateString(),close:t.value[t.value.length-1].close});const e=new Date(t.value[0].timestamp),l=new Date(t.value[t.value.length-1].timestamp),d=Math.ceil((l-e)/(1e3*60*60*24));console.log("차트 날짜 범위 (일수):",d)}console.log("=== 차트 렌더링 디버깅 끝 ===");const c=S.value.filter(e=>e!=null),h=y.value.slice(0,c.length);console.log("유효한 데이터:",{validDataLength:c.length,validLabelsLength:h.length,validDataRange:c.length>0?`${c[0]} ~ ${c[c.length-1]}`:"none"});const m={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis",formatter:function(e){const l=e[0];return`${new Date(l.axisValue).toLocaleDateString("ko-KR")}<br/>VIX: ${l.value.toFixed(2)}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:h},yAxis:{type:"value",min:function(e){return Math.max(0,e.min*.9)},max:function(e){return e.max*1.1}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:c}]};console.log("차트 옵션:",m),u.value.setOption(m,!0),console.log("차트 업데이트 완료"),setTimeout(()=>{console.log("=== 차트 렌더링 후 확인 ===");const e=u.value.getOption();console.log("실제 차트에 설정된 데이터 개수:",e.series?.[0]?.data?.length),console.log("실제 차트에 설정된 라벨 개수:",e.xAxis?.[0]?.data?.length),console.log("차트 크기:",u.value.getWidth(),"x",u.value.getHeight()),console.log("=== 차트 렌더링 확인 끝 ===")},100)},b=async()=>{console.log("새로고침 시작 - 강제 데이터 갱신");try{await T("1mo",!0),setTimeout(()=>{console.log("새로고침 후 차트 업데이트 시도"),console.log("새로고침 후 chartData:",t.value),console.log("새로고침 후 chartData.length:",t.value?.length),t.value&&t.value.length>0?(x(),console.log("새로고침 후 차트 업데이트 완료")):(console.log("새로고침 후에도 차트 데이터가 없음"),setTimeout(()=>{t.value&&t.value.length>0&&(x(),console.log("재시도 후 차트 업데이트 완료"))},500))},200)}catch(c){console.error("새로고침 중 오류:",c)}},$=()=>{u.value&&u.value.resize()};return pe([t,y,S],(c,h)=>{console.log("watch 트리거됨:",{newChartDataLength:c[0]?.length,newChartLabelsLength:c[1]?.length,newChartValuesLength:c[2]?.length,oldChartDataLength:h?.[0]?.length}),G(()=>{console.log("watch에서 차트 업데이트 시도"),t.value&&t.value.length>0?(x(),console.log("watch에서 차트 업데이트 완료")):console.log("watch에서 차트 데이터가 없음")})},{deep:!0,immediate:!1}),Z(()=>{G(()=>{H()})}),ee(()=>{u.value&&V.unregisterChart("vix"),window.removeEventListener("resize",$)}),(c,h)=>(Y(),B("div",we,[I("div",ye,[I("div",Ie,[N(Q,{icon:"mdi-chart-line",class:"me-2"}),h[0]||(h[0]=W(" VIX 지수 ",-1))]),I("div",Le,[N(Ve,{variant:"text",size:"small",onClick:b,loading:p(X)},{default:j(()=>[N(Q,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),p(A)!==null?(Y(),B("div",Ce,[I("div",Se,[h[1]||(h[1]=I("div",{class:"info-label"},"현재 VIX",-1)),I("div",{class:J(["info-value",p(R)])},O(p(E)(p(A))),3),I("div",{class:J(["info-change",p(C)>=0?"positive":"negative"])},O(p(k)(p(C)))+" ("+O(p(M)(p(q)))+") ",3)]),I("div",Xe,[h[2]||(h[2]=I("div",{class:"status-label"},"시장 상태",-1)),N(he,{color:p(R),size:"small",variant:"flat"},{default:j(()=>[W(O(p(P)),1)]),_:1},8,["color"])])])):K("",!0),I("div",$e,[I("div",{ref_key:"chartRef",ref:i,class:"chart",style:{height:"400px"}},null,512)]),p(X)?(Y(),B("div",_e,[N(xe,{indeterminate:"",color:"primary",size:"48"})])):K("",!0)]))}},Te=fe(be,[["__scopeId","data-v-dfe1d521"]]);export{Te as default};
