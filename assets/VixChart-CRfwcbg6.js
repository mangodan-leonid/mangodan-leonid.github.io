import{c as J,u as Q,a as Z,i as ee,b as te,d as ae,e as le,f as oe,g as ne,h as se}from"./useChartManager-DLRUxaxg.js";import{b2 as re,r as p,d as v,b3 as ie,o as K,b4 as W,a3 as ue,y as ce,A as U,a4 as M,a5 as N,W as f,ak as F,X as P,al as B,a6 as O,av as h,a9 as Y,ad as z}from"./index-Bi-kzDt5.js";import{k as G,V as he,T as ve}from"./VBtn-duQVuaXL.js";import{V as ge}from"./WorldMapLayout-DqgyVC0A.js";const j=re("vix",()=>{const l=p(null),i=p(null),u=p(!1),c=p(null),y=p(null),b=v(()=>{if(!l.value||!l.value.indicators?.quote?.[0])return null;const e=l.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),w=v(()=>{if(!l.value||!l.value.indicators?.quote?.[0])return null;const e=l.value.indicators.quote[0].close;if(!e||e.length<2)return null;const t=e[e.length-1],o=e[e.length-2];return t-o}),T=v(()=>{if(!l.value||!l.value.indicators?.quote?.[0])return null;const e=l.value.indicators.quote[0].close;if(!e||e.length<2)return null;const t=e[e.length-1],o=e[e.length-2];return(t-o)/o*100}),X=v(()=>{const e=b.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),S=v(()=>{switch(X.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),n=v(()=>{switch(X.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),m=v(()=>{if(console.log("chartData computed 실행, vixHistoryData:",i.value),!i.value||!i.value.timestamp)return console.log("차트 데이터 없음"),[];const e=i.value.timestamp||[],t=i.value.indicators?.quote?.[0]?.close||[],o=i.value.indicators?.quote?.[0]?.high||[],L=i.value.indicators?.quote?.[0]?.low||[],k=i.value.indicators?.quote?.[0]?.open||[],A=i.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:t.length,firstTimestamp:e[0],firstClose:t[0],lastTimestamp:e[e.length-1],lastClose:t[t.length-1],nullCount:t.filter(a=>a===null).length,undefinedCount:t.filter(a=>a===void 0).length});const V=e.map((a,s)=>({timestamp:a*1e3,date:new Date(a*1e3),close:t[s]!==null&&t[s]!==void 0?t[s]:null,high:o[s]!==null&&o[s]!==void 0?o[s]:null,low:L[s]!==null&&L[s]!==void 0?L[s]:null,open:k[s]!==null&&k[s]!==void 0?k[s]:null,volume:A[s]!==null&&A[s]!==void 0?A[s]:null})).filter(a=>a.close!==null&&a.close!==void 0);return console.log("차트 데이터 결과:",{totalItems:V.length,firstItem:V[0],lastItem:V[V.length-1],dateRange:V.length>0?`${V[0].date.toLocaleDateString()} ~ ${V[V.length-1].date.toLocaleDateString()}`:"none"}),V}),C=v(()=>m.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),D=v(()=>m.value.map(e=>e.close)),$=v(()=>{const e=D.value.filter(t=>t!==null);return e.length>0?Math.min(...e):0}),E=v(()=>{const e=D.value.filter(t=>t!==null);return e.length>0?Math.max(...e):0}),R=v(()=>{const e=D.value.filter(t=>t!==null);return e.length>0?e.reduce((t,o)=>t+o,0)/e.length:0});return{vixData:l,vixHistoryData:i,loading:u,error:c,lastUpdated:y,currentVix:b,vixChange:w,vixChangePercent:T,vixStatus:X,vixStatusText:S,vixStatusColor:n,chartData:m,chartLabels:C,chartValues:D,minValue:$,maxValue:E,averageValue:R,setVixData:e=>{l.value=e,y.value=new Date,c.value=null},setVixHistoryData:e=>{i.value=e,y.value=new Date,c.value=null},setLoading:e=>{u.value=e},setError:e=>{c.value=e,u.value=!1},clearError:()=>{c.value=null},reset:()=>{l.value=null,i.value=null,u.value=!1,c.value=null,y.value=null}}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function de(){const l=j(),i=J(),{vixData:u,vixHistoryData:c,loading:y,error:b,lastUpdated:w,currentVix:T,vixChange:X,vixChangePercent:S,vixStatus:n,vixStatusText:m,vixStatusColor:C,chartData:D,chartLabels:$,chartValues:E,minValue:R,maxValue:q,averageValue:H}=ie(l),g=p(null),_=p(!1),I=p(6e5),r=async()=>{try{l.setLoading(!0),l.clearError(),await new Promise(s=>setTimeout(s,1e3));const a=await i.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(a.data&&a.data.chart&&a.data.chart.result&&a.data.chart.result[0]){const s=a.data.chart.result[0];l.setVixData(s),console.log("VIX 데이터 업데이트 완료:",s)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(a){console.error("VIX 데이터 가져오기 실패:",a),l.setError(a.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{l.setLoading(!1)}},e=async(a="1mo",s=!1)=>{try{if(!s&&c.value&&w.value){const d=Date.now()-new Date(w.value).getTime();if(d<6e5)return console.log(`VIX 캐시 사용 (${Math.floor(d/1e3)}초 전 데이터)`),c.value}l.setLoading(!0),l.clearError(),await new Promise(d=>setTimeout(d,1500));const x=await i.get("/v8/finance/chart/^VIX",{params:{range:a,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(console.log("VIX API 응답 전체:",x.data),x.data&&x.data.chart&&x.data.chart.result&&x.data.chart.result[0]){const d=x.data.chart.result[0];return console.log("VIX 결과 데이터:",d),console.log("VIX 타임스탬프:",d.timestamp),console.log("VIX 인디케이터:",d.indicators),l.setVixHistoryData(d),console.log("VIX 히스토리 데이터 업데이트 완료:",d),d}else throw console.error("VIX 데이터 구조 문제:",x.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(x){return console.error("VIX 히스토리 데이터 가져오기 실패:",x),l.setError(x.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{l.setLoading(!1)}},t=()=>{g.value||(_.value=!0,g.value=setInterval(()=>{r()},I.value),console.log(`VIX 자동 새로고침 시작 (${I.value/1e3}초 간격)`))},o=()=>{g.value&&(clearInterval(g.value),g.value=null,_.value=!1,console.log("VIX 자동 새로고침 중지"))},L=a=>{I.value=a,_.value&&(o(),t())};return K(()=>{r(),t()}),W(()=>{o()}),{vixData:u,vixHistoryData:c,loading:y,error:b,lastUpdated:w,currentVix:T,vixChange:X,vixChangePercent:S,vixStatus:n,vixStatusText:m,vixStatusColor:C,chartData:D,chartLabels:$,chartValues:E,minValue:R,maxValue:q,averageValue:H,autoRefreshEnabled:_,refreshInterval:I,fetchVixData:r,fetchVixHistory:e,startAutoRefresh:t,stopAutoRefresh:o,setRefreshInterval:L,formatVixValue:a=>a==null?"N/A":a.toFixed(2),formatVixChange:a=>a==null?"N/A":`${a>=0?"+":""}${a.toFixed(2)}`,formatVixChangePercent:a=>a==null?"N/A":`${a>=0?"+":""}${a.toFixed(2)}%`,clearError:l.clearError,reset:l.reset}}const fe={class:"vix-chart-container"},me={class:"chart-header"},Ve={class:"chart-title"},xe={class:"chart-controls"},pe={key:0,class:"current-info"},ye={class:"info-card"},De={class:"status-card"},we={class:"chart-wrapper"},Ce={key:1,class:"loading-overlay"},Ie={__name:"VixChart",setup(l){Q([te,ae,le,oe,ne,se]);const i=p(null),u=p(null),c=Z(),y=j(),{currentVix:b,vixChange:w,vixChangePercent:T,vixStatusText:X,vixStatusColor:S,chartData:n,chartLabels:m,chartValues:C,loading:D,fetchVixHistory:$,formatVixValue:E,formatVixChange:R,formatVixChangePercent:q}=de(),H=async()=>{if(!i.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",i.value);try{u.value=ee(i.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",u.value),c.registerChart("vix",u.value),window.addEventListener("resize",I);const r={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};u.value.setOption(r,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작"),await $("1mo"),console.log("VIX 히스토리 데이터 로드 완료");const e=(t=1,o=5)=>{console.log(`차트 업데이트 시도 ${t}/${o}`),console.log("chartData.value:",n.value),console.log("chartData.value?.length:",n.value?.length),console.log("vixStore.vixHistoryData:",y.vixHistoryData),console.log("vixStore.chartData:",y.chartData),n.value&&n.value.length>0?(g(),console.log(`차트 업데이트 성공 (시도 ${t})`)):t<o?(console.log(`차트 데이터가 아직 준비되지 않음, ${500*t}ms 후 재시도`),setTimeout(()=>{e(t+1,o)},500*t)):console.log("최대 시도 횟수 초과, 차트 업데이트 실패")};setTimeout(()=>{e()},100)}catch(r){console.error("VIX 차트 초기화 실패:",r)}},g=()=>{if(!u.value){console.log("차트 인스턴스가 없습니다");return}if(!n.value||!n.value.length){console.log("차트 데이터가 없습니다:",n.value);return}console.log("차트 업데이트 시작:",{chartDataLength:n.value.length,chartLabelsLength:m.value.length,chartValuesLength:C.value.length,chartLabels:m.value.slice(0,5),chartValues:C.value.slice(0,5),firstDataPoint:n.value[0],lastDataPoint:n.value[n.value.length-1]});const r=C.value.filter(o=>o!=null),e=m.value.slice(0,r.length);console.log("유효한 데이터:",{validDataLength:r.length,validLabelsLength:e.length,validDataRange:r.length>0?`${r[0]} ~ ${r[r.length-1]}`:"none"});const t={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis",formatter:function(o){const L=o[0];return`${new Date(L.axisValue).toLocaleDateString("ko-KR")}<br/>VIX: ${L.value.toFixed(2)}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e},yAxis:{type:"value",min:function(o){return Math.max(0,o.min*.9)},max:function(o){return o.max*1.1}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:r}]};console.log("차트 옵션:",t),u.value.setOption(t,!0),console.log("차트 업데이트 완료")},_=async()=>{console.log("새로고침 시작 - 강제 데이터 갱신");try{await $("1mo",!0),setTimeout(()=>{console.log("새로고침 후 차트 업데이트 시도"),console.log("새로고침 후 chartData:",n.value),console.log("새로고침 후 chartData.length:",n.value?.length),n.value&&n.value.length>0?(g(),console.log("새로고침 후 차트 업데이트 완료")):(console.log("새로고침 후에도 차트 데이터가 없음"),setTimeout(()=>{n.value&&n.value.length>0&&(g(),console.log("재시도 후 차트 업데이트 완료"))},500))},200)}catch(r){console.error("새로고침 중 오류:",r)}},I=()=>{u.value&&u.value.resize()};return ce([n,m,C],(r,e)=>{console.log("watch 트리거됨:",{newChartDataLength:r[0]?.length,newChartLabelsLength:r[1]?.length,newChartValuesLength:r[2]?.length,oldChartDataLength:e?.[0]?.length}),U(()=>{console.log("watch에서 차트 업데이트 시도"),n.value&&n.value.length>0?(g(),console.log("watch에서 차트 업데이트 완료")):console.log("watch에서 차트 데이터가 없음")})},{deep:!0,immediate:!1}),K(()=>{U(()=>{H()})}),W(()=>{u.value&&c.unregisterChart("vix"),window.removeEventListener("resize",I)}),(r,e)=>(N(),M("div",fe,[f("div",me,[f("div",Ve,[P(G,{icon:"mdi-chart-line",class:"me-2"}),e[0]||(e[0]=B(" VIX 지수 ",-1))]),f("div",xe,[P(he,{variant:"text",size:"small",onClick:_,loading:h(D)},{default:O(()=>[P(G,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),h(b)!==null?(N(),M("div",pe,[f("div",ye,[e[1]||(e[1]=f("div",{class:"info-label"},"현재 VIX",-1)),f("div",{class:Y(["info-value",h(S)])},z(h(E)(h(b))),3),f("div",{class:Y(["info-change",h(w)>=0?"positive":"negative"])},z(h(R)(h(w)))+" ("+z(h(q)(h(T)))+") ",3)]),f("div",De,[e[2]||(e[2]=f("div",{class:"status-label"},"시장 상태",-1)),P(ge,{color:h(S),size:"small",variant:"flat"},{default:O(()=>[B(z(h(X)),1)]),_:1},8,["color"])])])):F("",!0),f("div",we,[f("div",{ref_key:"chartRef",ref:i,class:"chart",style:{height:"400px"}},null,512)]),h(D)?(N(),M("div",Ce,[P(ve,{indeterminate:"",color:"primary",size:"48"})])):F("",!0)]))}},$e=ue(Ie,[["__scopeId","data-v-dbb659b1"]]);export{$e as default};
