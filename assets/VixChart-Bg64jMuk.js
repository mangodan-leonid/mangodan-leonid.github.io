import{c as Z,u as ee,a as te,i as le,b as ae,d as oe,e as ne,f as se,g as re,h as ce}from"./useChartManager-xVNpJ06f.js";import{b2 as ie,r as D,d as f,b3 as ue,o as j,b4 as J,a3 as ge,y as he,A as O,a4 as z,a5 as F,W as x,ak as B,X as P,al as Y,a6 as G,av as v,a9 as K,ad as U}from"./index-B-H-tc8Q.js";import{k as W,V as ve,T as de}from"./VBtn-BWYpTVzB.js";import{V as fe}from"./WorldMapLayout-D4n88Gdh.js";const Q=ie("vix",()=>{const s=D(null),u=D(null),g=D(!1),h=D(null),y=D(null),X=f(()=>{if(!s.value||!s.value.indicators?.quote?.[0])return null;const e=s.value.indicators.quote[0].close;return e&&e.length>0?e[e.length-1]:null}),L=f(()=>{if(!s.value||!s.value.indicators?.quote?.[0])return null;const e=s.value.indicators.quote[0].close;if(!e||e.length<2)return null;const a=e[e.length-1],o=e[e.length-2];return a-o}),R=f(()=>{if(!s.value||!s.value.indicators?.quote?.[0])return null;const e=s.value.indicators.quote[0].close;if(!e||e.length<2)return null;const a=e[e.length-1],o=e[e.length-2];return(a-o)/o*100}),_=f(()=>{const e=X.value;return e?e<20?"low":e<30?"normal":"high":"unknown"}),T=f(()=>{switch(_.value){case"low":return"낮음 (안정)";case"normal":return"보통";case"high":return"높음 (불안정)";default:return"알 수 없음"}}),t=f(()=>{switch(_.value){case"low":return"success";case"normal":return"warning";case"high":return"error";default:return"grey"}}),m=f(()=>{if(console.log("chartData computed 실행, vixHistoryData:",u.value),!u.value||!u.value.timestamp)return console.log("차트 데이터 없음"),[];const e=u.value.timestamp||[],a=u.value.indicators?.quote?.[0]?.close||[],o=u.value.indicators?.quote?.[0]?.high||[],V=u.value.indicators?.quote?.[0]?.low||[],$=u.value.indicators?.quote?.[0]?.open||[],M=u.value.indicators?.quote?.[0]?.volume||[];console.log("차트 데이터 파싱:",{timestampsLength:e.length,closesLength:a.length,firstTimestamp:e[0],firstClose:a[0],lastTimestamp:e[e.length-1],lastClose:a[a.length-1],nullCount:a.filter(l=>l===null).length,undefinedCount:a.filter(l=>l===void 0).length});const r=e.map((l,c)=>({timestamp:l*1e3,date:new Date(l*1e3),close:a[c]!==null&&a[c]!==void 0?a[c]:null,high:o[c]!==null&&o[c]!==void 0?o[c]:null,low:V[c]!==null&&V[c]!==void 0?V[c]:null,open:$[c]!==null&&$[c]!==void 0?$[c]:null,volume:M[c]!==null&&M[c]!==void 0?M[c]:null})).filter(l=>l.close!==null&&l.close!==void 0);if(console.log("차트 데이터 결과:",{totalItems:r.length,firstItem:r[0],lastItem:r[r.length-1],dateRange:r.length>0?`${r[0].date.toLocaleDateString()} ~ ${r[r.length-1].date.toLocaleDateString()}`:"none"}),r.length>0){console.log("=== 차트 데이터 상세 분석 ==="),console.log("전체 데이터 포인트:",r.length),console.log("첫 번째 데이터:",{timestamp:r[0].timestamp,date:r[0].date.toLocaleDateString(),close:r[0].close}),console.log("마지막 데이터:",{timestamp:r[r.length-1].timestamp,date:r[r.length-1].date.toLocaleDateString(),close:r[r.length-1].close}),console.log("처음 5개 데이터:",r.slice(0,5).map(n=>({date:n.date.toLocaleDateString(),close:n.close}))),console.log("마지막 5개 데이터:",r.slice(-5).map(n=>({date:n.date.toLocaleDateString(),close:n.close})));const l=new Date(r[0].timestamp),c=new Date(r[r.length-1].timestamp),d=Math.ceil((c-l)/(1e3*60*60*24));console.log("날짜 범위 (일수):",d),console.log("=== 차트 데이터 분석 끝 ===")}return r}),w=f(()=>m.value.map(e=>new Date(e.timestamp).toLocaleDateString("ko-KR",{month:"short",day:"numeric"}))),C=f(()=>m.value.map(e=>e.close)),E=f(()=>{const e=C.value.filter(a=>a!==null);return e.length>0?Math.min(...e):0}),q=f(()=>{const e=C.value.filter(a=>a!==null);return e.length>0?Math.max(...e):0}),k=f(()=>{const e=C.value.filter(a=>a!==null);return e.length>0?e.reduce((a,o)=>a+o,0)/e.length:0});return{vixData:s,vixHistoryData:u,loading:g,error:h,lastUpdated:y,currentVix:X,vixChange:L,vixChangePercent:R,vixStatus:_,vixStatusText:T,vixStatusColor:t,chartData:m,chartLabels:w,chartValues:C,minValue:E,maxValue:q,averageValue:k,setVixData:e=>{s.value=e,y.value=new Date,h.value=null},setVixHistoryData:e=>{u.value=e,y.value=new Date,h.value=null},setLoading:e=>{g.value=e},setError:e=>{h.value=e,g.value=!1},clearError:()=>{h.value=null},reset:()=>{s.value=null,u.value=null,g.value=!1,h.value=null,y.value=null}}},{persist:{key:"vix-store",storage:localStorage,paths:["vixData","vixHistoryData","lastUpdated"]}});function me(){const s=Q(),u=Z(),{vixData:g,vixHistoryData:h,loading:y,error:X,lastUpdated:L,currentVix:R,vixChange:_,vixChangePercent:T,vixStatus:t,vixStatusText:m,vixStatusColor:w,chartData:C,chartLabels:E,chartValues:q,minValue:k,maxValue:H,averageValue:N}=ue(s),p=D(null),b=D(!1),I=D(6e5),i=async()=>{try{s.setLoading(!0),s.clearError(),await new Promise(c=>setTimeout(c,1e3));const l=await u.get("/v8/finance/chart/^VIX",{params:{range:"1d",interval:"1m",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(l.data&&l.data.chart&&l.data.chart.result&&l.data.chart.result[0]){const c=l.data.chart.result[0];s.setVixData(c),console.log("VIX 데이터 업데이트 완료:",c)}else throw new Error("VIX 데이터 형식이 올바르지 않습니다.")}catch(l){console.error("VIX 데이터 가져오기 실패:",l),s.setError(l.message||"VIX 데이터를 가져오는데 실패했습니다.")}finally{s.setLoading(!1)}},e=async(l="1mo",c=!1)=>{try{if(!c&&h.value&&L.value){const n=Date.now()-new Date(L.value).getTime();if(n<6e5)return console.log(`VIX 캐시 사용 (${Math.floor(n/1e3)}초 전 데이터)`),h.value}s.setLoading(!0),s.clearError(),await new Promise(n=>setTimeout(n,1500));const d=await u.get("/v8/finance/chart/^VIX",{params:{range:l,interval:"1d",includePrePost:!1,useYfid:!0,corsDomain:"finance.yahoo.com"}});if(console.log("VIX API 응답 전체:",d.data),d.data&&d.data.chart&&d.data.chart.result&&d.data.chart.result[0]){const n=d.data.chart.result[0];if(console.log("VIX 결과 데이터:",n),console.log("VIX 타임스탬프:",n.timestamp),console.log("VIX 인디케이터:",n.indicators),console.log("=== 배포 환경 디버깅 정보 ==="),console.log("타임스탬프 개수:",n.timestamp?.length),console.log("첫 번째 타임스탬프:",n.timestamp?.[0]),console.log("마지막 타임스탬프:",n.timestamp?.[n.timestamp?.length-1]),console.log("첫 번째 날짜:",n.timestamp?.[0]?new Date(n.timestamp[0]*1e3).toLocaleDateString():"N/A"),console.log("마지막 날짜:",n.timestamp?.[n.timestamp?.length-1]?new Date(n.timestamp[n.timestamp.length-1]*1e3).toLocaleDateString():"N/A"),n.indicators?.quote?.[0]){const S=n.indicators.quote[0];console.log("Close 데이터 개수:",S.close?.length),console.log("첫 번째 Close 값:",S.close?.[0]),console.log("마지막 Close 값:",S.close?.[S.close?.length-1]),console.log("Null 값 개수:",S.close?.filter(A=>A===null).length),console.log("Undefined 값 개수:",S.close?.filter(A=>A===void 0).length),console.log("유효한 값 개수:",S.close?.filter(A=>A!=null).length)}return console.log("=== 디버깅 정보 끝 ==="),s.setVixHistoryData(n),console.log("VIX 히스토리 데이터 업데이트 완료:",n),n}else throw console.error("VIX 데이터 구조 문제:",d.data),new Error("VIX 히스토리 데이터 형식이 올바르지 않습니다.")}catch(d){return console.error("VIX 히스토리 데이터 가져오기 실패:",d),s.setError(d.message||"VIX 히스토리 데이터를 가져오는데 실패했습니다."),null}finally{s.setLoading(!1)}},a=()=>{p.value||(b.value=!0,p.value=setInterval(()=>{i()},I.value),console.log(`VIX 자동 새로고침 시작 (${I.value/1e3}초 간격)`))},o=()=>{p.value&&(clearInterval(p.value),p.value=null,b.value=!1,console.log("VIX 자동 새로고침 중지"))},V=l=>{I.value=l,b.value&&(o(),a())};return j(()=>{i(),a()}),J(()=>{o()}),{vixData:g,vixHistoryData:h,loading:y,error:X,lastUpdated:L,currentVix:R,vixChange:_,vixChangePercent:T,vixStatus:t,vixStatusText:m,vixStatusColor:w,chartData:C,chartLabels:E,chartValues:q,minValue:k,maxValue:H,averageValue:N,autoRefreshEnabled:b,refreshInterval:I,fetchVixData:i,fetchVixHistory:e,startAutoRefresh:a,stopAutoRefresh:o,setRefreshInterval:V,formatVixValue:l=>l==null?"N/A":l.toFixed(2),formatVixChange:l=>l==null?"N/A":`${l>=0?"+":""}${l.toFixed(2)}`,formatVixChangePercent:l=>l==null?"N/A":`${l>=0?"+":""}${l.toFixed(2)}%`,clearError:s.clearError,reset:s.reset}}const pe={class:"vix-chart-container"},xe={class:"chart-header"},Ve={class:"chart-title"},De={class:"chart-controls"},ye={key:0,class:"current-info"},we={class:"info-card"},Ce={class:"status-card"},Le={class:"chart-wrapper"},Ie={key:1,class:"loading-overlay"},Se={__name:"VixChart",setup(s){ee([ae,oe,ne,se,re,ce]);const u=D(null),g=D(null),h=te(),y=Q(),{currentVix:X,vixChange:L,vixChangePercent:R,vixStatusText:_,vixStatusColor:T,chartData:t,chartLabels:m,chartValues:w,loading:C,fetchVixHistory:E,formatVixValue:q,formatVixChange:k,formatVixChangePercent:H}=me(),N=async()=>{if(!u.value){console.log("차트 ref가 없습니다");return}console.log("차트 초기화 시작, ref:",u.value),console.log("=== 환경 정보 ==="),console.log("개발 환경:",!1),console.log("프로덕션 환경:",!0),console.log("현재 URL:",window.location.href),console.log("User Agent:",navigator.userAgent),console.log("=== 환경 정보 끝 ===");try{g.value=le(u.value,null,{renderer:"canvas",useDirtyRect:!0}),console.log("ECharts 인스턴스 생성 완료:",g.value),h.registerChart("vix",g.value),window.addEventListener("resize",I);const i={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},data:[]}]};g.value.setOption(i,!0),console.log("기본 차트 렌더링 완료"),console.log("VIX 히스토리 데이터 로드 시작"),await E("1mo"),console.log("VIX 히스토리 데이터 로드 완료");const e=(a=1,o=5)=>{console.log(`차트 업데이트 시도 ${a}/${o}`),console.log("chartData.value:",t.value),console.log("chartData.value?.length:",t.value?.length),console.log("vixStore.vixHistoryData:",y.vixHistoryData),console.log("vixStore.chartData:",y.chartData),t.value&&t.value.length>0?(p(),console.log(`차트 업데이트 성공 (시도 ${a})`)):a<o?(console.log(`차트 데이터가 아직 준비되지 않음, ${500*a}ms 후 재시도`),setTimeout(()=>{e(a+1,o)},500*a)):console.log("최대 시도 횟수 초과, 차트 업데이트 실패")};setTimeout(()=>{e()},100)}catch(i){console.error("VIX 차트 초기화 실패:",i)}},p=()=>{if(!g.value){console.log("차트 인스턴스가 없습니다");return}if(!t.value||!t.value.length){console.log("차트 데이터가 없습니다:",t.value);return}if(console.log("차트 업데이트 시작:",{chartDataLength:t.value.length,chartLabelsLength:m.value.length,chartValuesLength:w.value.length,chartLabels:m.value.slice(0,5),chartValues:w.value.slice(0,5),firstDataPoint:t.value[0],lastDataPoint:t.value[t.value.length-1]}),console.log("=== 차트 렌더링 디버깅 ==="),console.log("차트 인스턴스 존재:",!!g.value),console.log("차트 데이터 존재:",!!t.value),console.log("차트 데이터 길이:",t.value?.length),console.log("차트 라벨 길이:",m.value?.length),console.log("차트 값 길이:",w.value?.length),t.value&&t.value.length>0){console.log("첫 번째 차트 데이터:",{timestamp:t.value[0].timestamp,date:t.value[0].date.toLocaleDateString(),close:t.value[0].close}),console.log("마지막 차트 데이터:",{timestamp:t.value[t.value.length-1].timestamp,date:t.value[t.value.length-1].date.toLocaleDateString(),close:t.value[t.value.length-1].close});const o=new Date(t.value[0].timestamp),V=new Date(t.value[t.value.length-1].timestamp),$=Math.ceil((V-o)/(1e3*60*60*24));console.log("차트 날짜 범위 (일수):",$)}console.log("=== 차트 렌더링 디버깅 끝 ===");const i=w.value.filter(o=>o!=null),e=m.value.slice(0,i.length);console.log("유효한 데이터:",{validDataLength:i.length,validLabelsLength:e.length,validDataRange:i.length>0?`${i[0]} ~ ${i[i.length-1]}`:"none"});const a={title:{text:"VIX 지수",left:"center"},tooltip:{trigger:"axis",formatter:function(o){const V=o[0];return`${new Date(V.axisValue).toLocaleDateString("ko-KR")}<br/>VIX: ${V.value.toFixed(2)}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e},yAxis:{type:"value",min:function(o){return Math.max(0,o.min*.9)},max:function(o){return o.max*1.1}},series:[{type:"line",smooth:!0,symbol:"none",lineStyle:{width:2,color:"#1976d2"},areaStyle:{color:"rgba(25, 118, 210, 0.1)"},data:i}]};console.log("차트 옵션:",a),g.value.setOption(a,!0),console.log("차트 업데이트 완료"),setTimeout(()=>{console.log("=== 차트 렌더링 후 확인 ===");const o=g.value.getOption();console.log("실제 차트에 설정된 데이터 개수:",o.series?.[0]?.data?.length),console.log("실제 차트에 설정된 라벨 개수:",o.xAxis?.[0]?.data?.length),console.log("차트 크기:",g.value.getWidth(),"x",g.value.getHeight()),console.log("=== 차트 렌더링 확인 끝 ===")},100)},b=async()=>{console.log("새로고침 시작 - 강제 데이터 갱신");try{await E("1mo",!0),setTimeout(()=>{console.log("새로고침 후 차트 업데이트 시도"),console.log("새로고침 후 chartData:",t.value),console.log("새로고침 후 chartData.length:",t.value?.length),t.value&&t.value.length>0?(p(),console.log("새로고침 후 차트 업데이트 완료")):(console.log("새로고침 후에도 차트 데이터가 없음"),setTimeout(()=>{t.value&&t.value.length>0&&(p(),console.log("재시도 후 차트 업데이트 완료"))},500))},200)}catch(i){console.error("새로고침 중 오류:",i)}},I=()=>{g.value&&g.value.resize()};return he([t,m,w],(i,e)=>{console.log("watch 트리거됨:",{newChartDataLength:i[0]?.length,newChartLabelsLength:i[1]?.length,newChartValuesLength:i[2]?.length,oldChartDataLength:e?.[0]?.length}),O(()=>{console.log("watch에서 차트 업데이트 시도"),t.value&&t.value.length>0?(p(),console.log("watch에서 차트 업데이트 완료")):console.log("watch에서 차트 데이터가 없음")})},{deep:!0,immediate:!1}),j(()=>{O(()=>{N()})}),J(()=>{g.value&&h.unregisterChart("vix"),window.removeEventListener("resize",I)}),(i,e)=>(F(),z("div",pe,[x("div",xe,[x("div",Ve,[P(W,{icon:"mdi-chart-line",class:"me-2"}),e[0]||(e[0]=Y(" VIX 지수 ",-1))]),x("div",De,[P(ve,{variant:"text",size:"small",onClick:b,loading:v(C)},{default:G(()=>[P(W,{icon:"mdi-refresh"})]),_:1},8,["loading"])])]),v(X)!==null?(F(),z("div",ye,[x("div",we,[e[1]||(e[1]=x("div",{class:"info-label"},"현재 VIX",-1)),x("div",{class:K(["info-value",v(T)])},U(v(q)(v(X))),3),x("div",{class:K(["info-change",v(L)>=0?"positive":"negative"])},U(v(k)(v(L)))+" ("+U(v(H)(v(R)))+") ",3)]),x("div",Ce,[e[2]||(e[2]=x("div",{class:"status-label"},"시장 상태",-1)),P(fe,{color:v(T),size:"small",variant:"flat"},{default:G(()=>[Y(U(v(_)),1)]),_:1},8,["color"])])])):B("",!0),x("div",Le,[x("div",{ref_key:"chartRef",ref:u,class:"chart",style:{height:"400px"}},null,512)]),v(C)?(F(),z("div",Ie,[P(de,{indeterminate:"",color:"primary",size:"48"})])):B("",!0)]))}},Te=ge(Se,[["__scopeId","data-v-633c65e1"]]);export{Te as default};
